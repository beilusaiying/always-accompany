# beilu-always accompany é¡¹ç›®æ€»ç»“

> ç‰ˆæœ¬: v2.0
> æ—¥æœŸ: 2026-02-20
> çŠ¶æ€: æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨å®Œæˆ + æ¡Œé¢æˆªå›¾/ç¾åŒ–ç³»ç»Ÿå¢å¼ºä¸­

---

## ä¸€ã€é¡¹ç›®å®šä½

**beilu-always accompanyï¼ˆè´éœ²æ°¸ä¼´ï¼‰** æ˜¯åŸºäº Fount æ¡†æ¶æ„å»ºçš„ AI ä¼´ä¾£ç³»ç»Ÿã€‚

æ ¸å¿ƒç†å¿µï¼š**è®© AI çœŸæ­£è®°ä½ä½ ã€‚** è®°å¿†æ‰æ˜¯æ ¸å¿ƒï¼Œå¯¹è¯åªæ˜¯è¡¨å±‚ã€‚

| ç»´åº¦     | è¯´æ˜                                                   |
| -------- | ------------------------------------------------------ |
| æ¡†æ¶     | Fountï¼ˆDeno åç«¯ + æµè§ˆå™¨å‰ç«¯ï¼‰                        |
| ç«¯å£     | HTTP: 1314                                             |
| ç”¨æˆ·     | linqingï¼ˆè‡ªåŠ¨ç™»å½•ï¼Œæ— éœ€æ‰‹åŠ¨è®¤è¯ï¼‰                      |
| å·¥ä½œç›®å½• | `d:\shajiuguan\beilu-ä¸ä½ ä¹‹è¯—\beilu-always accompany\` |
| AI æº    | æœ¬åœ°åä»£ claude-opus-4-6 (127.0.0.1:7862)              |

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 ä¸‰å±‚æ¨¡å¼

| å±‚         | æ¨¡å¼                         | AIå·¥å…·æ³¨å…¥             | å¯¹è¯æŒä¹…æ€§           |
| ---------- | ---------------------------- | ---------------------- | -------------------- |
| **èŠå¤©å±‚** | è§’è‰²æ‰®æ¼”                     | âŒ ä¸æ³¨å…¥å·¥å…·è¯´æ˜       | âœ… æŒä¹…ä¿å­˜           |
| **æ–‡ä»¶å±‚** | AIè¾…åŠ©æ–‡ä»¶æ“ä½œ               | âœ… beilu-files å·¥å…·è¯´æ˜ | âŒ ä¸´æ—¶ï¼ˆåˆ‡èµ°å³æ¸…é™¤ï¼‰ |
| **è®°å¿†å±‚** | è®°å¿†æŸ¥çœ‹/ç¼–è¾‘ + P1-P6 AIæ“ä½œ | âœ… è®°å¿†AIç‹¬ç«‹è¿è¡Œ       | âŒ å•æ¬¡æ³¨å…¥           |

### 2.2 ä¸¤å±‚AIç³»ç»Ÿ

- **èŠå¤©AIï¼ˆè´éœ²ï¼‰**ï¼šåœ¨"èŠå¤©å±‚"è§’è‰²æ‰®æ¼” / åœ¨"æ–‡ä»¶å±‚"é€šè¿‡ beilu-files ä¿®æ”¹ç”¨æˆ·é¡¹ç›®æ–‡ä»¶
- **è®°å¿†AIï¼ˆP1-P6ï¼‰**ï¼šåœ¨"è®°å¿†å±‚"å·¥ä½œï¼Œæ“æ§ memory/ ç›®å½•ä¸‹çš„æ¸©/å†·å±‚æ–‡ä»¶
- INJ-1ï¼ˆtableDataè¯´æ˜ï¼‰ï¼šautoMode='always'ï¼Œå‘èŠå¤©AIæ³¨å…¥è¡¨æ ¼æ•°æ®
- INJ-2ï¼ˆæ–‡ä»¶å±‚AIæç¤ºè¯ï¼‰ï¼šautoMode='manual'ï¼Œæ‰‹åŠ¨å¼€å…³æ§åˆ¶

### 2.3 5æ®µå¼æ¶ˆæ¯ç»“æ„

```
[beforeChat]        â€” é¢„è®¾å¤´éƒ¨, system only, æŒ‰ order æ’åº
[injectionAbove]    â€” @D>=1 æ³¨å…¥, any role, æŒ‰ order æ’åº
[chatHistory]       â€” å®é™…å¯¹è¯
[injectionBelow]    â€” @D=0 æ³¨å…¥, any role, æŒ‰ order æ’åº
[afterChat]         â€” é¢„è®¾å°¾éƒ¨, system only, æŒ‰ order æ’åº
```

æ•°æ®æµï¼š`preset_engine.mjs buildAllEntries()` â†’ `beilu-preset TweakPrompt` â†’ `serviceGenerator StructCall (commanderMode)`

---

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—

### 3.1 beilu æ’ä»¶ä½“ç³»ï¼ˆ12ä¸ªæ’ä»¶ï¼‰

| æ’ä»¶                | åŠŸèƒ½                                     | å…³é”®æ–‡ä»¶                           |
| ------------------- | ---------------------------------------- | ---------------------------------- |
| **beilu-preset**    | é¢„è®¾å¼•æ“ï¼Œ5æ®µå¼æ¶ˆæ¯æ„å»º                  | `plugins/beilu-preset/main.mjs`    |
| **beilu-memory**    | 4å±‚è®°å¿†ç³»ç»Ÿï¼ˆL0è¡¨æ ¼/L1çƒ­/L2æ¸©/L3å†·ï¼‰     | `plugins/beilu-memory/main.mjs`    |
| **beilu-files**     | æ–‡ä»¶æ“ä½œèƒ½åŠ›ï¼ˆè·¯å¾„å®‰å…¨+æ‰¹å‡†æœºåˆ¶ï¼‰        | `plugins/beilu-files/main.mjs`     |
| **beilu-eye**       | æ¡Œé¢æˆªå›¾æ³¨å…¥ï¼ˆPythonæˆªå›¾â†’å‰ç«¯filesç®¡çº¿ï¼‰ | `plugins/beilu-eye/main.mjs`       |
| **beilu-logger**    | æœåŠ¡å™¨æ—¥å¿—æ”¶é›†ï¼ˆconsoleåŠ«æŒ+HTTP APIï¼‰   | `plugins/beilu-logger/main.mjs`    |
| **beilu-toggle**    | åŠŸèƒ½å¼€å…³ç®¡ç†                             | `plugins/beilu-toggle/main.mjs`    |
| **beilu-agents**    | å¤šAIåä½œï¼ˆè¿œæœŸï¼‰                         | `plugins/beilu-agents/main.mjs`    |
| **beilu-regex**     | æ­£åˆ™æ›¿æ¢ï¼ˆç¾åŒ–ç³»ç»Ÿï¼‰                     | `plugins/beilu-regex/main.mjs`     |
| **beilu-worldbook** | ä¸–ç•Œä¹¦ç®¡ç†                               | `plugins/beilu-worldbook/main.mjs` |
| **beilu-web**       | ç½‘ç»œæœç´¢èƒ½åŠ›                             | `plugins/beilu-web/main.mjs`       |
| **beilu-sysinfo**   | ç³»ç»Ÿä¿¡æ¯æ³¨å…¥                             | `plugins/beilu-sysinfo/main.mjs`   |
| **beilu-multi-ai**  | *(å·²ç§»é™¤ï¼ŒåŠŸèƒ½åˆå¹¶)*                     | â€”                                  |

### 3.2 Shell ä½“ç³»

| Shell                   | åŠŸèƒ½                                                          | è·¯å¾„                          |
| ----------------------- | ------------------------------------------------------------- | ----------------------------- |
| **beilu-home**          | ç®¡ç†é¦–é¡µï¼ˆè§’è‰²å¡/é¢„è®¾/ä¸–ç•Œä¹¦/è®°å¿†/äººè®¾/ç³»ç»ŸæŸ¥çœ‹å™¨/è°ƒè¯•/æ—¥å¿—ï¼‰ | `shells/beilu-home/`          |
| **beilu-chat**          | èŠå¤©ç•Œé¢ï¼ˆä¸‰æ IDEå¸ƒå±€ã€è®°å¿†æµè§ˆå™¨ã€æ–‡ä»¶æ“ä½œã€å›¾ç‰‡æ”¶å‘ï¼‰       | `shells/beilu-chat/`          |
| **chat**                | Fountåç«¯èŠå¤©é€»è¾‘ï¼ˆå« deleteMessagesRangeï¼‰                   | `shells/chat/`                |
| **serviceSourceManage** | æœåŠ¡æºç®¡ç†                                                    | `shells/serviceSourceManage/` |
| **proxy**               | AIä»£ç†ï¼ˆcommanderModeç‰ˆï¼‰                                     | `shells/proxy/`               |
| **install**             | è§’è‰²å¡å¯¼å…¥å¤„ç†                                                | `shells/install/`             |

### 3.3 ImportHandlers

| Handler         | åŠŸèƒ½                              |
| --------------- | --------------------------------- |
| **SillyTavern** | ST æ ¼å¼è§’è‰²å¡/é¢„è®¾/ä¸–ç•Œä¹¦å¯¼å…¥     |
| **Risu**        | Risu æ ¼å¼å¯¼å…¥ï¼ˆccv3/charx/rpackï¼‰ |
| **fount**       | Fount åŸç”Ÿå¯¼å…¥ï¼ˆgit/zipï¼‰         |
| **MCP**         | MCP åè®®å¯¼å…¥ï¼ˆæ¨¡æ¿+å¼•æ“ï¼‰         |

### 3.4 ServiceGenerators

| ç±»å‹          | å¯ç”¨ç”Ÿæˆå™¨                                                                                        |
| ------------- | ------------------------------------------------------------------------------------------------- |
| **AI**        | proxy, gemini, claude, claude-api, ollama, grok, cohere, blackbox, duckduckgo, notdiamond, ç­‰14ç§ |
| **Search**    | google, google-api, brave, duckduckgo, ç­‰8ç§                                                      |
| **Translate** | google-translate, ç­‰5ç§                                                                           |

---

## å››ã€è®°å¿†ç³»ç»Ÿæ¦‚è§ˆ

> è¯¦ç»†è®¾è®¡è§ `beilu_memory_è®¾è®¡æ–‡æ¡£.md` v4.0
> AIæ“ä½œè§„èŒƒè§ `beilu_memory_AIæ“ä½œæ–‡æ¡£.md` v4.0

### 4.1 å››å±‚è®°å¿†æ¶æ„

| å±‚      | å­˜å‚¨                  | æ³¨å…¥æ–¹å¼               | å†…å®¹                                                  |
| ------- | --------------------- | ---------------------- | ----------------------------------------------------- |
| L0 è¡¨æ ¼ | `tables.json` (#0-#9) | æ¯è½®å…¨é‡æ³¨å…¥ CSV       | æ—¶ç©º/è§’è‰²/ç¤¾äº¤/ä»»åŠ¡/ä¸´æ—¶è®°å¿†/ç‰©å“/æ€»ç»“/æ°¸è¿œè®°ä½       |
| L1 çƒ­   | `hot/` ç›®å½•           | æ¯è½®æ³¨å…¥ï¼ˆTop-K/å…¨é‡ï¼‰ | forever/appointments/user_profile/remember_about_user |
| L2 æ¸©   | `warm/` ç›®å½•          | æ£€ç´¢AIæŒ‰éœ€è¯»å–         | æ—¥æ€»ç»“/æ‰¹æ¬¡å½’æ¡£/æœˆæ€»ç»“ï¼ˆæœ€è¿‘1ä¸ªæœˆï¼‰                   |
| L3 å†·   | `cold/` + `dialogue/` | æ£€ç´¢AIå¯¼èˆªæŸ¥æ‰¾         | æœˆæ€»ç»“/æ—¥æ€»ç»“ï¼ˆè¶…è¿‡1ä¸ªæœˆï¼‰                            |

### 4.2 è®°å¿†é¢„è®¾ç³»ç»Ÿ

| ID  | åç§°            | è§¦å‘              | ç”¨é€”                    |
| --- | --------------- | ----------------- | ----------------------- |
| P1  | æ£€ç´¢AI          | auto_on_message   | å¤šè½®æ·±åº¦æ£€ç´¢ï¼ˆæœ€å¤š5è½®ï¼‰ |
| P2  | è¡¨æ ¼æ€»ç»“/å½’æ¡£AI | auto_on_threshold | ä¸´æ—¶è®°å¿†è¶…é˜ˆå€¼å½’æ¡£      |
| P3  | æ¯æ—¥æ€»ç»“AI      | manual_button     | æ—¥ç»ˆæ±‡æ€»                |
| P4  | çƒ­â†’æ¸©è½¬ç§»AI     | manual_button     | çƒ­å±‚è¿‡æœŸè®°å¿†ç§»å…¥æ¸©å±‚    |
| P5  | æœˆåº¦æ€»ç»“/å½’æ¡£AI | manual_or_auto    | æ¸©â†’å†·æœˆæ€»ç»“             |
| P6  | æ ¼å¼æ£€æŸ¥/ä¿®å¤AI | manual_button     | è¡¨æ ¼å’Œè®°å¿†æ–‡ä»¶ä¿®å¤      |

### 4.3 æ³¨å…¥æç¤ºè¯

| ID    | åç§°             | autoMode | ç”¨é€”                             |
| ----- | ---------------- | -------- | -------------------------------- |
| INJ-1 | dataTableè¯´æ˜    | always   | è¡¨æ ¼CSV + `<tableEdit>` æ“ä½œè§„åˆ™ |
| INJ-2 | è®°å¿†æ–‡ä»¶æ“ä½œè¯´æ˜ | manual   | æ¸©/å†·å±‚æ–‡ä»¶æ“ä½œèƒ½åŠ›              |

### 4.4 å®æ–½é˜¶æ®µï¼ˆå…¨éƒ¨å®Œæˆï¼‰

- âœ… Phase 1ï¼šåŸºç¡€éª¨æ¶ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€è¡¨æ ¼è¯»å†™ã€è§£æå™¨ã€APIï¼‰
- âœ… Phase 2ï¼šå½’æ¡£ç³»ç»Ÿï¼ˆçƒ­/æ¸©/å†·å½’æ¡£ã€æ—¥ç»ˆ9æ­¥ã€å‰ç«¯ç»´æŠ¤æŒ‰é’®ï¼‰
- âœ… Phase 2.5ï¼šæç¤ºè¯ç³»ç»Ÿï¼ˆP1-P6 + INJ-1/INJ-2 + å®æ›¿æ¢ + å‰ç«¯ç®¡ç†ï¼‰
- âœ… Phase 3ï¼šæ£€ç´¢ç³»ç»Ÿï¼ˆP1å¤šè½®æ£€ç´¢ã€è‡ªåŠ¨è§¦å‘ã€è¾“å‡ºè§£æã€tokené¢„ç®—ã€dialogueå±‚ï¼‰
- âœ… Phase 4ï¼šå‰ç«¯ç®¡ç†ï¼ˆè¡¨æ ¼ç¼–è¾‘å™¨ã€ç®¡ç†é¢æ¿ã€è®°å¿†æµè§ˆå™¨ã€è‡ªå®šä¹‰è¡¨æ ¼ï¼‰

---

## äº”ã€è´éœ²çš„çœ¼ç›ï¼ˆæ¡Œé¢æˆªå›¾ç³»ç»Ÿï¼‰

> è¯¦ç»†å¼€å‘æ—¥å¿—è§ `beilu_worklog_è´éœ²çš„çœ¼ç›.md`

### 5.1 æ¶æ„

```
[Python æ¡Œé¢æˆªå›¾å·¥å…· beilu_eye.py]
  â”‚ æ¡Œé¢æ‚¬æµ®çƒ(tkinterç½®é¡¶) + Alt+Shift+S + æ‰˜ç›˜èœå•
  â”‚ mss æˆªå›¾ â†’ tkinter æ¡†é€‰ â†’ Pillow è£å‰ª â†’ 5MBå‹ç¼©
  â”‚
  â–¼ HTTP POST localhost:1314
[Fount åç«¯ web_server/endpoints.mjs]
  â”‚ /api/eye/inject â†’ setPendingInjection() (å« mode)
  â”‚ /api/eye/status â†’ getPendingStatus()
  â”‚ /api/eye/consume â†’ consumePendingInjection()
  â”‚
  â–¼ å‰ç«¯è½®è¯¢
[beilu-chat/index.mjs pollEyeStatus]
  â”‚ æ£€æµ‹åˆ° hasPending+mode=active
  â”‚ consume â†’ æ„å»º file å¯¹è±¡ â†’ addUserReply(files)
  â”‚
  â–¼ æ­£å¸¸æ¶ˆæ¯+æ–‡ä»¶ç®¡çº¿ï¼ˆä¸æµè§ˆå™¨ä¸Šä¼ å›¾ç‰‡å®Œå…¨ç›¸åŒï¼‰
[åç«¯ POST /message â†’ AI å¤šæ¨¡æ€å›å¤]
```

### 5.2 æŠ€æœ¯æ ˆ

| ç»„ä»¶       | å®ç°             | è¯´æ˜                              |
| ---------- | ---------------- | --------------------------------- |
| ç³»ç»Ÿæ‰˜ç›˜   | pystray          | é‡‘è‰² âœ¦ å›¾æ ‡                       |
| å…¨å±€å¿«æ·é”® | keyboard         | Alt+Shift+S                       |
| æ¡Œé¢æˆªå›¾   | mss              | DPI æ„ŸçŸ¥ï¼Œæ”¯æŒé«˜åˆ†è¾¨ç‡            |
| æ¡†é€‰è£å‰ª   | tkinter Canvas   | æ‹–æ‹½é€‰åŒº + é®ç½© + PhotoImage é˜²GC |
| æ¡Œé¢æ‚¬æµ®çƒ | tkinter Toplevel | 44px é‡‘è‰²åœ†å½¢ç½®é¡¶æ— è¾¹æ¡†çª—å£       |
| HTTP é€šä¿¡  | urllib.request   | base64 ç¼–ç  + 5MB å‹ç¼©            |
| è‡ªå¯åŠ¨     | beilu-eye æ’ä»¶   | æ¨¡å— import æ—¶ 3 ç§’å»¶è¿Ÿè‡ªå¯åŠ¨     |

### 5.3 å…³é”®è®¾è®¡å†³ç­–

- æˆªå›¾èµ°å‰ç«¯ files ç®¡çº¿ï¼ˆé GetPromptï¼‰ï¼Œé¿å…è¢« P1 è®°å¿†AIæå‰æ¶ˆè´¹
- Python æ›¿ä»£ Electronï¼ˆChromium åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå­˜åœ¨ 0xC0000005 å´©æºƒï¼‰
- æ¨¡å—é¡¶å±‚è‡ªå¯åŠ¨ï¼ˆshallowLoadDefaultPartsForUser åª import ä¸è°ƒ Loadï¼‰

---

## å…­ã€ç¾åŒ–ç³»ç»Ÿ

> è¯¦ç»†æ—¥å¿—è§ `beilu_worklog_ç¾åŒ–ç³»ç»Ÿ.md`

### 6.1 æ¸²æŸ“ç®¡çº¿

| åŠŸèƒ½             | çŠ¶æ€ | è¯´æ˜                                      |
| ---------------- | ---- | ----------------------------------------- |
| æ­£åˆ™æ›¿æ¢         | âœ…    | CRUD/æµ‹è¯•/å¯¼å…¥å¯¼å‡º/è§’è‰²å¡ç»‘å®š             |
| æ€ç»´é“¾æŠ˜å        | âœ…    | `<details>` é»˜è®¤æŠ˜å  + CSS max-height     |
| HTML iframe æ¸²æŸ“ | âœ…    | æ£€æµ‹ full-html â†’ iframe æ²™ç®±æ¸²æŸ“          |
| æ¸²æŸ“å™¨å¼€å…³       | âœ…    | localStorage `beilu-renderer-enabled`     |
| æ¸²æŸ“æ·±åº¦è®¾ç½®     | âœ…    | åªæ¸²æŸ“æœ€è¿‘Næ¥¼ `beilu-render-depth`        |
| ä»£ç æŠ˜å          | âœ…    | æŠ˜å ä»£ç å—ï¼Œæ”¯æŒå…¨éƒ¨/ä»…å‰ç«¯æ¨¡å¼           |
| æµå¼æ¸²æŸ“         | âœ…    | æµå¼è¾“å‡ºæ—¶500msé—´éš”æ›´æ–° iframe            |
| æ€ç»´é“¾èŠ‚æµ       | âœ…    | StreamRenderer MIN_RENDER_INTERVAL = 80ms |

### 6.2 å›¾ç‰‡å¤„ç†

| åŠŸèƒ½         | å®ç°æ–‡ä»¶                 | è¯´æ˜                                     |
| ------------ | ------------------------ | ---------------------------------------- |
| æ ¼å¼æ£€æµ‹ä¿®æ­£ | `imageProcessing.mjs`    | magic bytes æ£€æµ‹å®é™…æ ¼å¼ï¼Œä¿®æ­£ mime_type |
| å›¾ç‰‡å‹ç¼©     | `imageProcessing.mjs`    | >5MB è‡ªåŠ¨å‹ç¼©ï¼ˆsharp ä¼˜å…ˆï¼ŒPython å›é€€ï¼‰ |
| å¤šå¼€åœºç™½     | `usage.mjs` + `chat.mjs` | è§’è‰²å¡ç¼–è¾‘å¤šå¼€åœºç™½ + swipe åˆ‡æ¢          |

---

## ä¸ƒã€å…³é”®æŠ€æœ¯å†³ç­–æ±‡æ€»

| #   | å†³ç­–                                       | ç†ç”±                                |
| --- | ------------------------------------------ | ----------------------------------- |
| 1   | 5æ®µå¼æ¶ˆæ¯ç»“æ„æ›¿ä»£STçš„depthç³»ç»Ÿ             | ç®€åŒ–æ³¨å…¥é€»è¾‘ï¼Œæ¸…æ™°åˆ†æ®µ              |
| 2   | æ—¥ç»ˆå½’æ¡£æ‰‹åŠ¨è§¦å‘                           | é¿å…è¶…æ—¶/APIå¤±è´¥ä¸¢æ•°æ®              |
| 3   | P1å¼‚æ­¥éé˜»å¡ï¼ˆç»“æœä¸‹è½®æ³¨å…¥ï¼‰               | ä¸å½±å“ç”¨æˆ·ä½“éªŒ                      |
| 4   | #8 forever Top-Kæ´»è·ƒæ³¨å…¥                   | é¿å…æ— å…³æ°¸ä¹…è®°å¿†æµªè´¹token           |
| 5   | é¢„è®¾é…ç½®å…¨å±€åŒ–                             | P1-P6+INJå­˜`_global/`ï¼Œè¡¨æ ¼æŒ‰è§’è‰²åˆ† |
| 6   | çƒ­è®°å¿†é€šè¿‡`{{hotMemory}}`å®æ§åˆ¶            | åˆ é™¤ç¡¬ç¼–ç æ³¨å…¥ï¼Œç”¨æˆ·å®Œå…¨å¯æ§        |
| 7   | P1é˜²é‡å¤è§¦å‘ï¼ˆp1TriggeredForCurrentReplyï¼‰ | æµå¼ReplyHandlerå¤šæ¬¡è°ƒç”¨é—®é¢˜        |
| 8   | INJ-2 autoModeæ”¹ä¸ºmanual                   | fileæ¨¡å¼è‡ªåŠ¨å¯ç”¨ä¸å¯é               |
| 9   | æ–‡ä»¶æ¨¡å¼é€€å‡ºå½»åº•åˆ é™¤ç›¸å…³æ¶ˆæ¯               | æ–‡ä»¶æ“ä½œå¯¹è¯å¯¹åç»­èŠå¤©æ— ä»·å€¼        |
| 10  | è®°å¿†ç‹¬ç«‹äºå¯¹è¯                             | å¼€æ–°å¯¹è¯è®°å¿†ä¸å˜ï¼Œç»‘å®šè§’è‰²å¡        |
| 11  | æˆªå›¾èµ° files ç®¡çº¿è€Œé GetPrompt            | é¿å…è¢« P1 è®°å¿†AIæå‰æ¶ˆè´¹            |
| 12  | Python æ›¿ä»£ Electron æ¡Œé¢æˆªå›¾              | Chromium ç³»ç»Ÿçº§å´©æºƒæ— æ³•ä¿®å¤         |
| 13  | beilu-eye æ¨¡å—é¡¶å±‚è‡ªå¯åŠ¨                   | shallow load ä¸è°ƒ Load()            |

---

## å…«ã€ç›®å½•ç»“æ„

```
beilu-always accompany/
â”œâ”€â”€ run.bat / run.sh           â† å¯åŠ¨è„šæœ¬
â”œâ”€â”€ deno.json                  â† Denoé…ç½®
â”œâ”€â”€ desktop-eye/               â† Python æ¡Œé¢æˆªå›¾å·¥å…·
â”‚   â”œâ”€â”€ beilu_eye.py           â† ä¸»ç¨‹åºï¼ˆæˆªå›¾+æ‚¬æµ®çƒ+æ‰˜ç›˜ï¼‰
â”‚   â””â”€â”€ renderer/              â† Electron é—ç•™æ–‡ä»¶ï¼ˆå·²å¼ƒç”¨ï¼‰
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ config.json            â† HTTP:1314, defaultPartsï¼ˆ12ä¸ªæ’ä»¶ï¼‰
â”‚   â”œâ”€â”€ beilu-files-settings.json â† æ–‡ä»¶æ“ä½œå®‰å…¨è®¾ç½®
â”‚   â””â”€â”€ users/
â”‚       â”œâ”€â”€ _default/          â† é»˜è®¤è®°å¿†æ¨¡æ¿
â”‚       â”‚   â””â”€â”€ chars/_global/memory/  â† è®°å¿†é¢„è®¾+é»˜è®¤è¡¨æ ¼
â”‚       â””â”€â”€ linqing/           â† ä¸»ç”¨æˆ·
â”‚           â”œâ”€â”€ settings/      â† parts_config/parts_init/char_data
â”‚           â”œâ”€â”€ serviceSources/AI/ â† 3ä¸ªAIæºï¼ˆè´éœ²çš„geminiç­‰ï¼‰
â”‚           â”œâ”€â”€ personas/å‡›å€¾/ â† ç”¨æˆ·äººè®¾
â”‚           â”œâ”€â”€ shells/chat/chats/ â† èŠå¤©è®°å½•ï¼ˆ8ä¸ªå¯¹è¯æ–‡ä»¶ï¼‰
â”‚           â””â”€â”€ chars/         â† è§’è‰²å¡æ•°æ®
â”‚               â”œâ”€â”€ _global/memory/ â† å…¨å±€è®°å¿†é¢„è®¾ï¼ˆP1-P6+INJï¼‰
â”‚               â”œâ”€â”€ è´éœ²/memory/    â† è´éœ²ä¸“å±è®°å¿†ï¼ˆå«warmæ—¥è®°ï¼‰
â”‚               â”œâ”€â”€ æµ‹è¯•å‘˜/memory/  â† æµ‹è¯•å‘˜è®°å¿†
â”‚               â””â”€â”€ ç™¾ç§‘å…¨ä¹¦/memory/ â† ç™¾ç§‘å…¨ä¹¦è®°å¿†
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ decl/                  â† TypeScript ç±»å‹å£°æ˜
â”‚   â”œâ”€â”€ scripts/               â† åç«¯å·¥å…·è„šæœ¬ï¼ˆ12ä¸ªï¼‰
â”‚   â”œâ”€â”€ server/                â† åç«¯æ ¸å¿ƒï¼ˆä¿®æ”¹ç‰ˆï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.mjs           â† è‡ªåŠ¨ç™»å½•
â”‚   â”‚   â”œâ”€â”€ base.mjs           â† å»SW/Sentry/æ›´æ–°
â”‚   â”‚   â”œâ”€â”€ parts_loader.mjs   â† æ¨¡å—åŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ web_server/
â”‚   â”‚       â”œâ”€â”€ endpoints.mjs  â† eye APIç«¯ç‚¹ + verifycode stub
â”‚   â”‚       â””â”€â”€ index.mjs      â† ä¸»è·¯ç”±
â”‚   â””â”€â”€ public/
â”‚       â”œâ”€â”€ locales/           â† 20ä¸ªè¯­è¨€æ–‡ä»¶
â”‚       â”œâ”€â”€ pages/             â† å‰ç«¯å…¬å…±è„šæœ¬å’Œæ ·å¼
â”‚       â””â”€â”€ parts/
â”‚           â”œâ”€â”€ shells/        â† 6ä¸ªshell
â”‚           â”œâ”€â”€ plugins/       â† 12ä¸ªbeiluæ’ä»¶ï¼ˆå«AGENTS.mdï¼‰
â”‚           â”œâ”€â”€ serviceGenerators/ â† AI/Search/Translate ç”Ÿæˆå™¨
â”‚           â”œâ”€â”€ ImportHandlers/ â† SillyTavern/Risu/fount/MCP
â”‚           â””â”€â”€ personas/      â† äººè®¾ç®¡ç†æ¨¡å—
â””â”€â”€ default/                   â† é»˜è®¤é…ç½®æ¨¡æ¿
```

---

## ä¹ã€å‰ç«¯é¡µé¢ç»“æ„

### 9.1 beilu-homeï¼ˆç®¡ç†é¦–é¡µï¼‰

å¯¼èˆªé¡¹ï¼ˆ11ä¸ªæ ‡ç­¾ï¼‰ï¼š

- ğŸ“‹ ä½¿ç”¨ï¼ˆè§’è‰²å¡ç®¡ç† â€” ç½‘æ ¼å±•ç¤º+å¯¼å…¥+æ–°å»º+ç¼–è¾‘+åˆ é™¤+é™„å±èµ„æºæå–ï¼‰
- ğŸŒ ä¸–ç•Œä¹¦ç®¡ç†
- ğŸ“ èŠå¤©é¢„è®¾
- ğŸ§  è®°å¿†é¢„è®¾ï¼ˆP1-P6 + INJ-1/INJ-2 + æ£€ç´¢é…ç½® + å®å‚è€ƒï¼‰
- ğŸ“Š è®°å¿†ç®¡ç†ï¼ˆè¡¨æ ¼ç¼–è¾‘å™¨ + ç»´æŠ¤é¢æ¿ï¼‰
- ğŸ‘¤ ç”¨æˆ·äººè®¾ï¼ˆå¤šäººè®¾ç®¡ç† â€” æ–°å»º/ç¼–è¾‘/åˆ é™¤/æœç´¢ï¼‰
- ğŸ“– ç³»ç»ŸæŸ¥çœ‹å™¨ï¼ˆå†…ç½®æ–‡æ¡£ï¼‰
- âš™ï¸ ç³»ç»Ÿè®¾ç½®ï¼ˆAIæºé…ç½® + åŠŸèƒ½æ’ä»¶å¼€å…³ï¼‰
- ğŸ› è°ƒè¯•é¢æ¿ï¼ˆä¼ªå‘é€é¢„è§ˆï¼‰
- ğŸ“œ æœåŠ¡å™¨æ—¥å¿—ï¼ˆbeilu-logger å®æ—¶æ—¥å¿—æŸ¥çœ‹ï¼‰
- ğŸ”¬ AIè¯Šæ–­ï¼ˆè®°å¿†AIè¿è¡Œè¾“å‡º+æ³¨å…¥çŠ¶æ€+P1ç¼“å­˜æŸ¥çœ‹ï¼‰

### 9.2 beilu-chatï¼ˆèŠå¤©ç•Œé¢ï¼‰

ä¸‰æ IDEå¸ƒå±€ï¼š

- **å·¦æ **ï¼šé¢„è®¾ç®¡ç† + ä¸–ç•Œä¹¦ç»‘å®š + äººè®¾é€‰æ‹© + è§’è‰²å¿«æ·ç¼–è¾‘
- **ä¸­æ **ï¼šèŠå¤©/æ–‡ä»¶/è®°å¿† ä¸‰æ ‡ç­¾åˆ‡æ¢
  - èŠå¤©Tabï¼šæ¶ˆæ¯æµ + è®°å¿†AIè¾“å‡ºé¢æ¿
  - æ–‡ä»¶Tabï¼šIDEæ–‡ä»¶ç¼–è¾‘å™¨
  - è®°å¿†Tabï¼šP2-P6æ“ä½œ + è®°å¿†æ–‡ä»¶æµè§ˆå™¨ + å¯¼å…¥å¯¼å‡º
- **å³æ **ï¼šè§’è‰²ä¿¡æ¯ + åŠŸèƒ½å¼€å…³ï¼ˆæ¸²æŸ“å™¨/ä»£ç æŠ˜å /æµå¼æ¸²æŸ“/æ¸²æŸ“æ·±åº¦ï¼‰ + è®°å¿†AIæ“ä½œï¼ˆP2-P6æ‰‹åŠ¨æŒ‰é’®ï¼‰

### 9.3 å‰ç«¯æ¨¡å—æ¸…å•ï¼ˆbeilu-chatï¼‰

| æ¨¡å—         | æ–‡ä»¶                   | èŒè´£                                 |
| ------------ | ---------------------- | ------------------------------------ |
| èŠå¤©æ ¸å¿ƒ     | `chat.mjs`             | æ¶ˆæ¯å‘é€/æ¥æ”¶/ç¼–è¾‘/åˆ é™¤              |
| æµå¼è¾“å‡º     | `stream.mjs`           | WebSocket æµå¼æ¥æ”¶                   |
| å¸ƒå±€ç®¡ç†     | `layout.mjs`           | ä¸‰æ å¸ƒå±€ + åŠŸèƒ½å¼€å…³ç»‘å®š              |
| æ¶ˆæ¯æ¸²æŸ“     | `displayRegex.mjs`     | æ­£åˆ™æ›¿æ¢ + HTML/markdown æ£€æµ‹        |
| å›¾ç‰‡å¤„ç†     | `imageProcessing.mjs`  | æ ¼å¼æ£€æµ‹ + å‹ç¼©ï¼ˆåç«¯ï¼‰              |
| æ–‡ä»¶æµè§ˆå™¨   | `fileExplorer.mjs`     | IDE æ–‡ä»¶æ ‘                           |
| æ–‡ä»¶ç¼–è¾‘     | `files.mjs`            | æ–‡ä»¶åˆ›å»º/ç¼–è¾‘/åˆ é™¤                   |
| è®°å¿†æµè§ˆå™¨   | `memoryBrowser.mjs`    | è®°å¿†æ–‡ä»¶æŸ¥çœ‹/å¯¼å…¥å¯¼å‡º                |
| è®°å¿†é¢„è®¾     | `memoryPresetChat.mjs` | P2-P6 æ‰‹åŠ¨æ“ä½œé¢æ¿                   |
| æ•°æ®è¡¨æ ¼     | `dataTable.mjs`        | è®°å¿†è¡¨æ ¼ç¼–è¾‘å™¨                       |
| APIé…ç½®      | `apiConfig.mjs`        | AIæºé€‰æ‹©/å‚æ•°è°ƒæ•´                    |
| æ­£åˆ™ç¼–è¾‘å™¨   | `regexEditor.mjs`      | æ­£åˆ™è„šæœ¬CRUD/æµ‹è¯•/å¯¼å…¥å¯¼å‡º           |
| æç¤ºè¯æŸ¥çœ‹å™¨ | `promptViewer.mjs`     | å®Œæ•´æç¤ºè¯é¢„è§ˆ                       |
| UIå­æ¨¡å—     | `ui/*.mjs`             | æ¶ˆæ¯åˆ—è¡¨/è¾“å…¥æ¡†/ä¾§è¾¹æ /æ‹–æ‹½/æ¨¡æ€æ¡†ç­‰ |

---

## åã€å®å˜é‡æ”¯æŒ

| å®                    | P1-P6 | INJ | é¢„è§ˆ | è¯´æ˜                 |
| --------------------- | ----- | --- | ---- | -------------------- |
| `{{tableData}}`       | âœ…     | âœ…   | âœ…    | å…¨éƒ¨è¡¨æ ¼CSVæ•°æ®      |
| `{{hotMemory}}`       | âœ…     | âœ…   | âœ…    | çƒ­è®°å¿†å±‚æ–‡ä»¶å†…å®¹     |
| `{{char}}`            | âœ…     | âœ…   | âœ…    | è§’è‰²å               |
| `{{user}}`            | âœ…     | âœ…   | âœ…    | ç”¨æˆ·å               |
| `{{current_date}}`    | âœ…     | âœ…   | âœ…    | å½“å‰æ—¥æœŸ             |
| `{{chat_history}}`    | âœ…     | âœ…   | å ä½ | æœ€è¿‘å¯¹è¯è®°å½•         |
| `{{lastUserMessage}}` | âœ…     | âœ…   | å ä½ | æœ€åç”¨æˆ·æ¶ˆæ¯         |
| `{{time}}`            | âœ…     | âœ…   | âœ…    | å½“å‰æ—¶é—´             |
| `{{date}}`            | âœ…     | âœ…   | âœ…    | å½“å‰æ—¥æœŸï¼ˆæœ¬åœ°æ ¼å¼ï¼‰ |
| `{{weekday}}`         | âœ…     | âœ…   | âœ…    | æ˜ŸæœŸå‡                |
| `{{idle_duration}}`   | âœ…     | âœ…   | å ä½ | è·ä¸Šæ¬¡æ¶ˆæ¯çš„æ—¶é—´     |
| `{{lasttime}}`        | âœ…     | âœ…   | å ä½ | æœ€åæ¶ˆæ¯æ—¶é—´         |
| `{{lastdate}}`        | âœ…     | âœ…   | å ä½ | æœ€åæ¶ˆæ¯æ—¥æœŸ         |

---

## åä¸€ã€AIæºé…ç½®

| æºåç§°            | ç”Ÿæˆå™¨ | æ¨¡å‹                 | ç«¯ç‚¹                          | ç”¨é€”   |
| ----------------- | ------ | -------------------- | ----------------------------- | ------ |
| è´éœ²çš„gemini      | proxy  | claude-opus-4-6      | 127.0.0.1:7862/antigravity/v1 | ä¸»åŠ›AI |
| xiaokeAntigravity | proxy  | claude-opus-4-6      | 127.0.0.1:7862/antigravity/v1 | å¤‡ç”¨AI |
| 3proå…¬ç›Šç«™        | proxy  | gemini-3-pro-preview | onehub.srixy.net/v1           | å…¬ç›Šç«™ |

æ‰€æœ‰ API é€šè¿‡æœ¬åœ°åä»£ï¼Œä¸å­˜åœ¨ç½‘ç»œé—®é¢˜ã€‚

---

## åäºŒã€ç›¸å¯¹äºå¹²å‡€Fountçš„ä¿®æ”¹æ–‡ä»¶

### æœåŠ¡å™¨ç«¯

| æ–‡ä»¶                              | ä¿®æ”¹æ€§è´¨                                     |
| --------------------------------- | -------------------------------------------- |
| `server/base.mjs`                 | å»SW/Sentry/æ›´æ–°/æ„šäººèŠ‚                      |
| `server/auth.mjs`                 | è‡ªåŠ¨ç™»å½•                                     |
| `server/index.mjs`                | ç§»é™¤Sentry                                   |
| `server/server.mjs`               | ç§»é™¤Tray/DiscordRPC/AutoUpdate               |
| `server/info.mjs`                 | å“ç‰Œå+ç§»é™¤èŠ‚æ—¥å½©è›‹                          |
| `server/autoupdate.mjs`           | ç©ºstub                                       |
| `server/parts_loader.mjs`         | doProfile stub + ç§»é™¤git                     |
| `server/web_server/index.mjs`     | ç§»é™¤Sentry+sentrytunnel                      |
| `server/web_server/endpoints.mjs` | verifycode stub + PoW disabled + eye APIç«¯ç‚¹ |

### å®¢æˆ·ç«¯

| æ–‡ä»¶                            | ä¿®æ”¹æ€§è´¨    |
| ------------------------------- | ----------- |
| `pages/base.mjs`                | SWæ³¨é”€      |
| `pages/scripts/i18n.mjs`        | ç§»é™¤Sentry  |
| `pages/scripts/toast.mjs`       | ç§»é™¤Sentry  |
| `ImportHandlers/fount/main.mjs` | ç§»é™¤gitæ“ä½œ |

### Shellä¿®æ”¹

| æ–‡ä»¶                                           | ä¿®æ”¹æ€§è´¨                                          |
| ---------------------------------------------- | ------------------------------------------------- |
| `shells/chat/src/chat.mjs`                     | ç§»é™¤achievements + deleteMessagesRange + fakeSend |
| `shells/chat/src/endpoints.mjs`                | deleteMessagesRangeè·¯ç”± + fake-sendè·¯ç”±           |
| `shells/serviceSourceManage/src/actions.mjs`   | ç§»é™¤achievements                                  |
| `shells/serviceSourceManage/src/endpoints.mjs` | ç§»é™¤achievements                                  |
| `shells/serviceSourceManage/src/manager.mjs`   | åˆå¹¶ä¿å­˜ + config shell importæ›¿æ¢                |
| `serviceGenerators/AI/gemini/main.mjs`         | commanderModeç‰ˆ                                   |
| `serviceGenerators/AI/proxy/main.mjs`          | commanderModeç‰ˆ                                   |
| `serviceGenerators/AI/proxy/display.mjs`       | æ¨¡å‹é€‰æ‹©å™¨                                        |

---

## åä¸‰ã€å·²çŸ¥é—®é¢˜

| é—®é¢˜                                    | ä¸¥é‡åº¦ | çŠ¶æ€                       |
| --------------------------------------- | ------ | -------------------------- |
| ç¾åŒ–åŠŸèƒ½ï¼ˆdisplay regexï¼‰åˆ·æ–°åæ¶ˆæ¯æ¶ˆå¤± | ğŸŸ¡      | æç½®ï¼ˆä¸»äººå†³å®šæš‚ä¸ä¿®å¤ï¼‰   |
| i18n 500 é”™è¯¯                           | ğŸŸ¢      | éè‡´å‘½ï¼Œæœ‰try-catchå¤„ç†    |
| ä¸–ç•Œä¹¦æ¡ç›®é«˜äº®CSSæ³„æ¼                   | ğŸŸ¢      | å¾…åç»­ç¡®è®¤                 |
| è´éœ²çš„çœ¼ç›ç«¯åˆ°ç«¯éªŒè¯                    | ğŸŸ¡      | æˆªå›¾â†’AIè¯†åˆ« æµç¨‹å¾…æœ€ç»ˆéªŒè¯ |

---

## åå››ã€å·¥ä½œæ—¥å¿—ç´¢å¼•

| æ—¥å¿—æ–‡ä»¶                                    | å†…å®¹                                                               |
| ------------------------------------------- | ------------------------------------------------------------------ |
| `beilu_worklog_æ°¸ä¼´æ„å»º.md`                 | é¡¹ç›®å®Œæ•´æ„å»ºæ—¥å¿—ï¼ˆå‹ç¼©ç‰ˆï¼‰ï¼Œä»Founté‡‡è´­åˆ°beiluæ¨¡å—æ³¨å…¥             |
| `beilu_memory_è®¾è®¡æ–‡æ¡£.md`                  | è®°å¿†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ v4.0ï¼ˆPhase 1-4å…¨éƒ¨å®Œæˆï¼‰                         |
| `beilu_memory_AIæ“ä½œæ–‡æ¡£.md`                | è®°å¿†ç³»ç»ŸAIæ“ä½œè§„èŒƒ v4.0                                            |
| `beilu_worklog_è®°å¿†æ¡†æ¶åˆ¶ä½œ.md`             | è®°å¿†å‰ç«¯æ¡†æ¶ï¼šå¯¼å…¥å¯¼å‡ºzipã€P2-P6æ‰‹åŠ¨æŒ‰é’®                           |
| `beilu_worklog_P1å¤šè½®æ£€ç´¢ä¸æ–‡ä»¶æ¨¡å¼éš”ç¦».md` | P1å¤šè½®æ·±åº¦æœç´¢ + æ–‡ä»¶æ¨¡å¼ä¸Šä¸‹æ–‡éš”ç¦»                                |
| `beilu_worklog_ç³»ç»ŸæŸ¥çœ‹å™¨ä¸èŠå¤©è¯Šæ–­.md`     | ç©ºæ°”æ³¡è¯Šæ–­ä¿®å¤ + çƒ­è®°å¿†ç¡¬ç¼–ç ä¿®å¤ + é¢„è®¾å…¨å±€åŒ– + P1é˜²é‡å¤ + æ—¶é—´å® |
| `beilu_worklog_è®°å¿†AIæ“ä½œ.md`               | P2æè¿°ä¿®æ­£ + è‡ªåŠ¨è§¦å‘è¡¥å®Œ + æ‰‹åŠ¨æŒ‰é’®                               |
| `beilu_worklog_å±‚çº§æƒé™ä¸æ’ä»¶é…ç½®.md`       | ä¸‰å±‚æ¨¡å¼è®¾è®¡ + beilu-fileså¯å±•å¼€é…ç½®é¢æ¿                           |
| `beilu_worklog_ä¸–ç•Œä¹¦ä¸äººè®¾.md`             | ä¸–ç•Œä¹¦ç»‘å®š + ç”¨æˆ·äººè®¾ç®¡ç†ï¼ˆæ–¹æ¡ˆè®¾è®¡+å®ç°ï¼‰                         |
| `beilu_worklog_è§’è‰²å¡ç»‘å®š.md`               | è§’è‰²å¡å¯¼å…¥æ—¶è‡ªåŠ¨æå–æ­£åˆ™/ä¸–ç•Œä¹¦å¹¶ç»‘å®š                              |
| `beilu_worklog_è´éœ²çš„çœ¼ç›.md`               | æ¡Œé¢æˆªå›¾ç³»ç»Ÿå®Œæ•´å¼€å‘æ—¥å¿—ï¼ˆ9è½®è¿­ä»£ï¼‰                                |
| `beilu_worklog_ç¾åŒ–ç³»ç»Ÿ.md`                 | æ¸²æŸ“ç®¡çº¿6é¡¹å¢å¼ºï¼ˆå¼€å…³/æ·±åº¦/æŠ˜å /èŠ‚æµ/æµå¼æ¸²æŸ“ï¼‰                    |
| `beilu_worklog_ç¾åŒ–ä¸å¼€åœºç™½.md`             | å¤šå¼€åœºç™½+404å¤´åƒä¿®å¤+ç‚¹å‡»å‘é€                                      |
| `é¡¹ç›®å’Œä¿®æ”¹æ±‡æŠ¥.md`                         | å˜æ›´è®°å½•ï¼šæ¨¡å‹é€‰æ‹©å™¨ã€DryRunã€serviceSourceManageä¿®å¤ç­‰            |
| `AGENTS(ä¸ä½ ä¹‹è¯—).md`                       | æ¨¡å—è¯´æ˜æ–‡æ¡£                                                       |
| `å‚è€ƒé¡¹ç›®åˆ†æä¸åŠŸèƒ½å¯¹æ ‡.md`                 | JS-Slash-Runner/st-memory-enhancement/APT å¯¹æ ‡åˆ†æ                 |

---

## åäº”ã€è¿œæœŸè§„åˆ’

| åŠŸèƒ½                           | è¯´æ˜                                |
| ------------------------------ | ----------------------------------- |
| åŒæ­¥åˆ°æºé¡¹ç›®                   | å…¨éƒ¨å®Œæˆåä¸€æ¬¡æ€§è½¬ç§»åˆ° fount-beilu/ |
| JS-Slash-Runner æ¸²æŸ“å¼•æ“       | æ›¿æ¢æœ‰bugçš„displayRegex             |
| st-memory-enhancement è¡¨æ ¼å¢å¼º | å¢å¼ºbeilu-memory                    |
| APT æ¡ç›®åˆ‡æ¢                   | å¢å¼ºbeilu-toggle                    |
| å¤šAIåä½œ                       | beilu-agents                        |
| AIå¼•æ“ï¼ˆä»£ç ç¼–è¾‘èƒ½åŠ›ï¼‰         | è¿œæœŸ                                |
| Vector DB / RAG                | Phase 4 â€” è¯­ä¹‰æ£€ç´¢                  |
| Embedding API                  | Gemini text-embedding-004           |

---

*æ­¤æ–‡æ¡£ç»¼åˆäº† beilu-always accompany é¡¹ç›®æˆªè‡³ 2026-02-20 çš„æ‰€æœ‰å·¥ä½œæ—¥å¿—ã€è®¾è®¡æ–‡æ¡£å’Œå®é™…ä»£ç åˆ†æã€‚å¦‚éœ€è¯¦ç»†äº†è§£æŸä¸ªæ¨¡å—ï¼Œè¯·å‚è€ƒå¯¹åº”çš„å·¥ä½œæ—¥å¿—æ–‡ä»¶ã€‚*
