{
  "rules": [
    {
      "id": "mlstxlom3wufn",
      "scriptName": "æ–°è§„åˆ™",
      "findRegex": "",
      "replaceString": "",
      "trimStrings": "",
      "placement": [
        "ai_output"
      ],
      "disabled": false,
      "runOnEdit": false,
      "substituteRegex": 0,
      "minDepth": -1,
      "maxDepth": 0,
      "markdownOnly": false,
      "promptOnly": false,
      "scope": "scoped",
      "boundCharName": ""
    },
    {
      "id": "mlsxy08svq9vl",
      "scriptName": "è´éœ²çš„ç¾åŒ–",
      "findRegex": "<game_text>([\\s\\S]*?)<\\/game_text>",
      "replaceString": "```\n<!doctype html>\n<html lang=\"zh-CN\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, viewport-fit=cover\" />\n    <title>è´éœ²çš„å¯¹è¯</title>\n    <!-- 1. Error Handler Script (Must be first and separate) -->\n    <script>\n      window.onerror = function (message, source, lineno, colno, error) {\n        console.error(`[Global Error] ${message} at ${source}:${lineno}:${colno}`, error);\n        // Only alert if the app hasn't mounted (checking for raw template syntax)\n        setTimeout(() => {\n          const appEl = document.getElementById('app');\n          if (appEl && (appEl.innerHTML.includes('{{') || appEl.innerHTML.trim() === '')) {\n            alert(`Critical Error: Script failed to load.\\n${message}\\nLine: ${lineno}`);\n          }\n        }, 1000);\n      };\n    </script>\n    <script src=\"https://unpkg.com/vue@3/dist/vue.global.prod.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js\"></script>\n    <link\n      href=\"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Inter:wght@300;400;500;700&family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;500&display=swap\"\n      rel=\"stylesheet\"\n    />\n    <style>\n      :root {\n        /* è´éœ²ä¸»é¢˜è‰²æ¿ - ç¥ç€æš–é‡‘è‰²ç³» */\n        --theme-bg: #fdf8f0;\n        --panel-bg-frosted-blue: rgba(255, 240, 220, 0.7);\n        --text-primary: #4a4540;\n        --text-secondary: #8a8070;\n        --text-on-grad: #ffffff;\n        --border-color: rgba(200, 180, 140, 0.4);\n        --shadow-light: rgba(180, 150, 100, 0.1);\n        --shadow-medium: rgba(180, 150, 100, 0.15);\n\n        /* æ¸å˜è‰² */\n        --grad-settings: linear-gradient(120deg, #fdfbf7 0%, #f5efe6 100%);\n\n        /* å¼ºè°ƒè‰² */\n        --accent-amber: #d4a017;\n        --accent-pink: #d4a017; /* ä¿æŒå˜é‡åå…¼å®¹ï¼Œå®é™…æ”¹ä¸ºç¥ç€è‰² */\n        --accent-blue: #8b7355;\n        --accent-red: #c75050;\n        --accent-green: #42b983;\n        --progress-bg: rgba(0, 0, 0, 0.07);\n\n        /* å­—ä½“ */\n        --font-main: 'Inter', 'Noto Sans SC', sans-serif;\n        --font-title: 'Orbitron', 'Noto Sans SC', sans-serif;\n        --font-numeric: 'Roboto Mono', 'monospace';\n      }\n\n      body {\n        margin: 0;\n        padding: 0;\n        background-color: var(--theme-bg); /* ä½¿ç”¨æŸ”å’Œçš„èƒŒæ™¯è‰² */\n        font-family: var(--font-main);\n        color: var(--text-primary);\n        line-height: 1.6;\n        /* ç§»é™¤ overflow, width, height, è®© body è‡ªç„¶é€‚åº” */\n      }\n\n      #app {\n        width: 100%;\n        /* ç§»é™¤ height, display, justify-content, align-items */\n        position: relative;\n      }\n\n      /* æ¸¸æˆå®¹å™¨ - ä¿æŒæ¯”ä¾‹é€‚é… */\n      .game-container {\n        position: relative;\n        width: 100%;\n        max-width: 100%;\n        container-type: inline-size;\n        /* è¿™ä¸ªå®¹å™¨ç°åœ¨åªæ˜¯ä¸€ä¸ªç®€å•çš„åŒ…è£¹å™¨ */\n      }\n\n      /* ç§»åŠ¨ç«¯é€‚é… */\n      @container (max-width: 768px) {\n        /* è°ƒæ•´ç§»åŠ¨ç«¯å¯¹è¯æ¡†ä½ç½® */\n        .dialogue-container {\n          padding: 1.3cqw 2.6cqw 2.6cqw 2.6cqw; /* 10px 20px 20px 20px / 768 */\n        }\n\n        .dialogue-box {\n          padding: 1.95cqw 2.6cqw; /* 15px 20px / 768 */\n        }\n\n        /* è°ƒæ•´ç§»åŠ¨ç«¯å›¾æ ‡å¤§å° */\n        .corner-icon {\n          width: 6.5cqw; /* 50 / 768 */\n          height: 6.5cqw; /* 50 / 768 */\n          bottom: 2.6cqw; /* 20 / 768 */\n        }\n\n\n        /* è°ƒæ•´ç§»åŠ¨ç«¯å¯¼èˆªæ  */\n        .nav-group {\n          padding: 0.65cqw 1.3cqw; /* 5px 10px / 768 */\n        }\n\n        .nav-button {\n          padding: 0.65cqw 1cqw; /* 5px 8px / 768 */\n          font-size: clamp(0.7em, 2cqw, 0.8em);\n        }\n\n        .time-location-display {\n          min-width: 13cqw; /* 100 / 768 */\n          font-size: clamp(0.6em, 1.8cqw, 0.7em);\n        }\n      }\n\n      /* 1. ä¸»èˆå° (Center Stage) */\n      .center-stage {\n        width: 100%;\n        /* ä½¿ç”¨ padding-bottom åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„å®¹å™¨ï¼Œä¿æŒ 16:9 çš„æ¯”ä¾‹ */\n        padding-bottom: 56.25%; /* 9 / 16 = 0.5625 */\n        height: 0;\n        position: relative;\n        z-index: 1;\n        overflow: hidden; /* ç¡®ä¿å†…éƒ¨ç»å¯¹å®šä½çš„å…ƒç´ ä¸ä¼šæº¢å‡º */\n      }\n\n      .background-layer {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-size: cover;\n        background-position: center;\n        transition: filter 0.5s ease;\n      }\n\n      .character-layer {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        justify-content: center;\n        align-items: flex-end;\n        pointer-events: none;\n        transition: filter 0.5s ease;\n        z-index: 2;\n        padding: 0 5%; /* Prevent characters from touching edges */\n        box-sizing: border-box;\n      }\n\n      /* Layout variants for multiple characters */\n      .character-layer.layout-1 {\n        justify-content: center;\n      }\n      .character-layer.layout-2 {\n        justify-content: space-between;\n      }\n      .character-layer.layout-3 {\n        justify-content: space-between;\n      }\n      .character-layer.layout-4 {\n        justify-content: space-between;\n      }\n\n      .character-sprite {\n        height: 90%; /* ä½¿ç”¨ç›¸å¯¹é«˜åº¦ */\n        /* max-height: 95%; Removed to enforce fixed height */\n        width: 41.5cqw; /* 660 / 1280 */\n        min-width: 31.25cqw; /* 400 / 1280 */\n        object-fit: cover;\n        object-position: top center;\n        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2));\n        transition: all 0.5s ease;\n        transform-origin: bottom center;\n        flex-shrink: 0;\n      }\n\n      .character-sprite.full-body {\n        height: auto;\n        width: auto;\n        max-height: 95%;\n        max-width: 100%;\n        min-width: 0;\n        object-fit: contain;\n        object-position: bottom center;\n        flex-shrink: 1;\n      }\n\n      /* Single character specific */\n      .character-layer.layout-1 .character-sprite {\n        width: 40.5cqw; /* 660 / 1280 */\n      }\n      .character-layer.layout-1 .character-sprite.full-body {\n        width: auto;\n        max-width: 90%;\n      }\n\n      /* Adjust sizes based on character count */\n      .character-layer.layout-2 .character-sprite {\n        max-width: 45%;\n        width: 39.87cqw; /* 600 / 1280 */\n        min-width: 31.25cqw; /* 400 / 1280 */\n      }\n      .character-layer.layout-3 .character-sprite {\n        max-width: 32%;\n        width: 38.96cqw; /* 550 / 1280 */\n        min-width: 31.25cqw; /* 400 / 1280 */\n      }\n      .character-layer.layout-4 .character-sprite {\n        max-width: 16%;\n        width: 30.15cqw; /* 450 / 1280 */\n        min-width: 27.34cqw; /* 350 / 1280 */\n      }\n\n      /* Full body overrides for multi-character layouts */\n      .character-layer.layout-2 .character-sprite.full-body,\n      .character-layer.layout-3 .character-sprite.full-body,\n      .character-layer.layout-4 .character-sprite.full-body {\n        width: auto;\n        min-width: 0;\n        height: auto;\n        max-height: 90%;\n        object-fit: contain;\n      }\n\n      .cg-layer {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-size: contain;\n        background-repeat: no-repeat;\n        background-position: center;\n        z-index: 3;\n        pointer-events: none;\n        transition: opacity 0.5s ease;\n      }\n\n      /* æ¨¡ç³Šæ•ˆæœ */\n      .center-stage.blurred .background-layer,\n      .center-stage.blurred .character-layer,\n      .center-stage.blurred .cg-layer {\n        filter: blur(8px) brightness(0.8);\n      }\n\n      /* 2. é¡¶éƒ¨å¯¼èˆª (Top Nav) - åˆ˜æµ·é£æ ¼ */\n      .top-nav {\n        position: absolute; /* æ”¹å› absolute å®ç°æ‚¬æµ®è¦†ç›– */\n        top: 0;\n        left: 0;\n        width: 100%;\n        display: flex;\n        justify-content: space-between; /* åˆ†æ•£å¯¹é½ */\n        align-items: flex-start;\n        padding: 0;\n        z-index: 50;\n        pointer-events: none;\n      }\n\n      .nav-group {\n        display: flex;\n        width: 100%;\n        justify-content: space-between; /* æŒ‰é’®åˆ†æ•£ */\n        align-items: center;\n        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.2)); /* æ›´é«˜é€æ˜åº¦ */\n        backdrop-filter: blur(3px);\n        padding: 0.4cqw 1.56cqw; /* 5px 20px / 1280 */\n        border-bottom: 1px solid rgba(255, 255, 255, 0.3);\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\n        pointer-events: auto;\n      }\n\n      .nav-left,\n      .nav-right {\n        display: flex;\n        gap: 0.78cqw; /* 10 / 1280 */\n      }\n\n      .nav-button {\n        background: transparent;\n        border: none;\n        padding: 0.4cqw 0.94cqw; /* 5px 12px / 1280 */\n        cursor: pointer;\n        color: var(--text-secondary);\n        font-weight: 500;\n        font-size: clamp(0.8em, 1.4cqw, 1em);\n        display: flex;\n        align-items: center;\n        gap: 0.625cqw; /* 8 / 1280 */\n        transition: all 0.3s;\n      }\n\n      .nav-button:hover {\n        transform: scale(1.05);\n        color: var(--text-primary);\n      }\n\n      .nav-button.active {\n        background: transparent;\n        color: var(--accent-amber);\n        text-shadow: 0 0 5px rgba(212, 160, 23, 0.4);\n      }\n\n      .nav-icon {\n        width: 1.875cqw; /* 24 / 1280 */\n        height: 1.875cqw; /* 24 / 1280 */\n        object-fit: contain;\n        filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));\n      }\n\n      .nav-text-img {\n        height: 1.56cqw; /* 20 / 1280 */\n        width: auto; /* ä¿æŒæ¯”ä¾‹ */\n        display: block;\n        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));\n      }\n\n      .time-location-display {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 0 15px;\n        border-left: 1px solid rgba(0, 0, 0, 0.1);\n        border-right: 1px solid rgba(0, 0, 0, 0.1);\n        margin: 0 5px;\n        font-size: 0.8em;\n        color: var(--text-primary);\n        min-width: 15.6cqw; /* 200 / 1280 */\n        text-align: center;\n      }\n      .info-row-top {\n        font-weight: bold;\n        color: var(--text-primary);\n        margin-bottom: 2px;\n      }\n      .info-row-bottom {\n        font-size: 0.9em;\n        color: var(--accent-pink);\n        max-width: 400px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      /* Fullscreen Button */\n      .fullscreen-btn {\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        font-size: 1.2em;\n        color: var(--text-secondary);\n        transition: transform 0.2s;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      .fullscreen-btn:hover {\n        transform: scale(1.1);\n        color: var(--text-primary);\n      }\n\n      /* Volume Slider Styles */\n      .volume-control {\n        width: 100%;\n        padding: 10px 0;\n      }\n      .volume-slider {\n        width: 100%;\n        height: 6px;\n        background: rgba(173, 216, 230, 0.4);\n        outline: none;\n        -webkit-appearance: none;\n        border-radius: 3px;\n        margin-top: 10px;\n      }\n      .volume-slider::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        width: 20px;\n        height: 20px;\n        background: var(--accent-pink);\n        border-radius: 50%;\n        cursor: pointer;\n        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n        transition: transform 0.1s;\n      }\n      .volume-slider::-webkit-slider-thumb:hover {\n        transform: scale(1.1);\n      }\n\n      /* 3. å¯¹è¯æ¡† (Dialogue Box) */\n      .dialogue-container {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        width: 100%;\n        padding: 1.56cqw 1.56cqw 0 1.56cqw; /* 20 / 1280 */\n        box-sizing: border-box;\n        z-index: 40;\n        display: flex;\n        justify-content: center;\n        align-items: flex-end; /* åº•éƒ¨å¯¹é½ */\n        gap: 0.78cqw; /* 10 / 1280 */\n        pointer-events: none;\n      }\n\n      .dialogue-box {\n        flex-grow: 1;\n        max-width: 62.5cqw; /* 800 / 1280 */\n        /* ä¹³ç™½è‰²é€æ˜æ ·å¼ */\n        background: rgba(255, 255, 255, 0.3);\n        backdrop-filter: blur(4px);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n        border-radius: 1.875cqw; /* 24 / 1280 */\n        padding: 1.875cqw 2.5cqw; /* 24px 32px / 1280 */\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);\n        pointer-events: auto;\n        position: relative;\n        transition:\n          transform 0.3s,\n          opacity 0.3s;\n      }\n\n      .dialogue-box.hidden {\n        transform: translateY(150%);\n        opacity: 0;\n      }\n\n      /* éšè—UIæ—¶çš„æ ·å¼ */\n      .ui-hidden .corner-icon {\n        opacity: 0;\n        pointer-events: none;\n        transform: scale(0.8);\n      }\n\n      .speaker-name {\n        font-family: var(--font-title);\n        font-size: clamp(1em, 1.8cqw, 1.2em);\n        font-weight: 700;\n        color: var(--accent-amber);\n        margin-bottom: 0.625cqw; /* 8 / 1280 */\n        text-shadow: 0 1px 2px rgba(212, 160, 23, 0.1);\n      }\n\n      .dialogue-text {\n        font-size: clamp(0.9em, 1.6cqw, 1.1em);\n        color: #000000; /* çº¯é»‘å­—ä½“ä»¥å¢åŠ å¯¹æ¯”åº¦ */\n        font-weight: 500; /* ç¨å¾®åŠ ç²— */\n        line-height: 1.7;\n        min-height: 3.4em;\n        max-height: 4.5em; /* Approx 3 lines */\n        overflow-y: auto;\n        padding-right: 0.78cqw; /* 10 / 1280 */\n        white-space: pre-wrap; /* Preserve whitespace for newlines */\n      }\n      .translation-text {\n        display: block;\n        /* font-size: 0.85em; Removed per user request */\n        color: #333333; /* åŠ æ·±é¢œè‰²ä»¥å¢åŠ å¯¹æ¯”åº¦ */\n        font-weight: 600;\n        margin-top: 4px;\n        font-style: italic;\n      }\n      /* Custom Scrollbar for Dialogue */\n      .dialogue-text::-webkit-scrollbar {\n        width: 6px;\n      }\n      .dialogue-text::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.05);\n        border-radius: 3px;\n      }\n      .dialogue-text::-webkit-scrollbar-thumb {\n        background: rgba(212, 160, 23, 0.3);\n        border-radius: 3px;\n      }\n      .dialogue-text::-webkit-scrollbar-thumb:hover {\n        background: rgba(212, 160, 23, 0.6);\n      }\n\n      /* 4. å·¦å³ä¸‹è§’å›¾æ ‡ (QB & Soul Gem) */\n      .corner-icon {\n        position: relative; /* æ”¹ä¸ºç›¸å¯¹å®šä½ï¼Œå‚ä¸ Flex å¸ƒå±€ */\n        bottom: auto;\n        width: 7.8cqw; /* 100 / 1280 */\n        height: 7.8cqw; /* 100 / 1280 */\n        flex-shrink: 0;\n        cursor: pointer;\n        z-index: 45;\n        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        pointer-events: auto;\n        filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.15));\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n\n      .corner-icon:hover {\n        transform: scale(1.05);\n      }\n\n      /* 5. å¼¹å‡ºé¢æ¿ (Popups) */\n      .popup-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        z-index: 100;\n        pointer-events: none; /* å…è®¸ç‚¹å‡»ç©¿é€åˆ°é®ç½©å±‚ä»¥ä¸‹ï¼Œé™¤éç‚¹å‡»äº†é¢æ¿ */\n      }\n\n      .popup-backdrop {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.2);\n        backdrop-filter: blur(2px);\n        pointer-events: auto;\n      }\n\n      .popup-panel {\n        position: absolute;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 90%;\n        max-width: min(90%, 62.5cqw); /* 800 / 1280 */\n        background: #fff;\n        border-radius: 1.56cqw; /* 20 / 1280 */\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);\n        overflow: hidden;\n        pointer-events: auto;\n        display: flex;\n        flex-direction: column;\n        max-height: 80vh;\n        border: 2px solid transparent;\n        animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1);\n      }\n\n      @keyframes slideDown {\n        from {\n          transform: translate(-50%, -50px);\n          opacity: 0;\n        }\n        to {\n          transform: translate(-50%, 0);\n          opacity: 1;\n        }\n      }\n\n      @keyframes slideUp {\n        from {\n          transform: translate(-50%, 50px);\n          opacity: 0;\n        }\n        to {\n          transform: translate(-50%, 0);\n          opacity: 1;\n        }\n      }\n\n      .popup-panel.top-down {\n        top: 80px; /* ä½äºå¯¼èˆªæ ä¸‹æ–¹ */\n      }\n\n      .popup-panel.bottom-up {\n        bottom: 100px; /* ä½äºåº•éƒ¨æ ä¸Šæ–¹ */\n        animation-name: slideUp;\n      }\n\n      .popup-panel.popup-settings {\n        background: var(--grad-settings);\n        border-color: #ddd;\n      }\n      .popup-panel.popup-log {\n        background: linear-gradient(135deg, #fff, #f0f4f8);\n        border-color: #dde;\n      }\n\n      .popup-header {\n        padding: 1.17cqw 1.56cqw; /* 15px 20px / 1280 */\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-bottom: 1px solid rgba(255, 255, 255, 0.3);\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      .popup-title {\n        font-family: var(--font-title);\n        font-weight: 700;\n        color: var(--text-primary);\n        margin: 0;\n      }\n\n      .popup-close {\n        background: none;\n        border: none;\n        font-size: 1.5em;\n        cursor: pointer;\n        color: var(--text-secondary);\n        transition: transform 0.2s;\n      }\n      .popup-close:hover {\n        transform: scale(1.2);\n        color: var(--accent-red);\n      }\n\n      .popup-content {\n        padding: 1.56cqw; /* 20 / 1280 */\n        overflow-y: auto;\n        background: rgba(255, 255, 255, 0.6);\n      }\n\n      /* é€šç”¨ç»„ä»¶æ ·å¼ */\n      .data-item {\n        margin-bottom: 12px;\n        padding-bottom: 12px;\n        border-bottom: 1px solid var(--border-color);\n        font-size: 0.95em;\n        display: flex;\n        align-items: center;\n        flex-wrap: wrap;\n      }\n      .data-item:last-child {\n        border-bottom: none;\n      }\n      .data-item strong {\n        width: 100px;\n        color: var(--text-primary);\n        font-weight: 500;\n        margin-right: 10px;\n        flex-shrink: 0;\n      }\n      .data-item span.value {\n        color: var(--text-primary);\n        font-weight: 500;\n        flex-grow: 1;\n        word-break: break-word;\n        white-space: pre-wrap;\n      }\n      .progress-container {\n        flex-grow: 1;\n        height: 18px;\n        background-color: var(--progress-bg);\n        border-radius: 9px;\n        overflow: hidden;\n        position: relative;\n        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);\n        border: 1px solid rgba(0, 0, 0, 0.05);\n      }\n      .progress-fill {\n        height: 100%;\n        border-radius: 9px;\n        transition: width 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);\n      }\n      /* è£‚ç¼æ•ˆæœ (Low HP) */\n      .cracked-effect {\n        position: relative;\n      }\n      .cracked-effect::after {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" viewBox=\"0 0 100 100\"><path d=\"M10,10 L30,30 M50,10 L40,40 M80,10 L70,30 M10,50 L30,60 M90,50 L70,70 M20,90 L40,80\" stroke=\"rgba(0,0,0,0.2)\" stroke-width=\"1\" fill=\"none\"/></svg>');\n        background-size: cover;\n        opacity: 0.6;\n        pointer-events: none;\n        z-index: 10;\n      }\n\n      .card-block {\n        background: linear-gradient(150deg, rgba(255, 255, 255, 0.9), rgba(245, 250, 255, 0.95));\n        border-radius: 12px;\n        padding: 20px 25px;\n        margin-bottom: 20px;\n        box-shadow: 0 4px 15px var(--shadow-light);\n        position: relative;\n        overflow: hidden;\n        transition: all 0.3s ease;\n      }\n      .card-block h4 {\n        margin: -20px -25px 20px -25px;\n        padding: 12px 25px;\n        color: var(--text-on-grad);\n        font-size: 1.1em;\n        font-weight: 600;\n        text-align: center;\n        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n        border-radius: 12px 12px 0 0;\n      }\n      .no-data-message {\n        color: var(--text-secondary);\n        font-style: italic;\n        text-align: center;\n        padding: 30px 20px;\n      }\n      .value-display {\n        transition: all 0.3s ease;\n        display: inline-block;\n      }\n      .value-changed-up {\n        animation: flash-green 0.7s ease-out;\n      }\n      .value-changed-down {\n        animation: flash-red 0.7s ease-out;\n      }\n      .inventory-items,\n      .combat-items {\n        flex-direction: column;\n        align-items: flex-start;\n      }\n      .item-list {\n        display: flex;\n        flex-direction: column;\n        align-items: flex-start;\n        gap: 8px;\n        margin-top: 8px;\n        width: 100%;\n      }\n      .item-button {\n        background: linear-gradient(145deg, #f9faff, #f2f5ff);\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        padding: 8px 14px;\n        font-family: var(--font-main);\n        font-size: 0.9em;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        text-align: left;\n        width: 100%;\n        box-shadow: 0 1px 3px var(--shadow-light);\n      }\n      .item-button:hover {\n        background: linear-gradient(145deg, #ffffff, #f7f9ff);\n        border-color: var(--accent-blue);\n        color: var(--accent-blue);\n        transform: translateY(-2px);\n        box-shadow: 0 4px 10px var(--shadow-medium);\n      }\n      .item-button:disabled {\n        background-color: #e9ecef;\n        color: #adb5bd;\n        cursor: not-allowed;\n        transform: none;\n        border-color: var(--border-color);\n      }\n      .item-button:disabled:hover {\n        background-color: #e9ecef;\n        color: #adb5bd;\n      }\n\n      @keyframes fadeIn {\n        from {\n          opacity: 0;\n        }\n        to {\n          opacity: 1;\n        }\n      }\n\n      /* è®¾ç½®é¢æ¿å¼€å…³ */\n      .switch-row {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 0;\n        border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n      }\n      .switch-btn {\n        width: 50px;\n        height: 26px;\n        background: #ccc;\n        border-radius: 13px;\n        position: relative;\n        cursor: pointer;\n        transition: background 0.3s;\n      }\n      .switch-btn.on {\n        background: var(--accent-green);\n      }\n      .switch-thumb {\n        width: 22px;\n        height: 22px;\n        background: white;\n        border-radius: 50%;\n        position: absolute;\n        top: 2px;\n        left: 2px;\n        transition: left 0.3s;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n      }\n      .switch-btn.on .switch-thumb {\n        left: 26px;\n      }\n\n      /* éšè—/æ˜¾ç¤ºå¯¹è¯æ¡†æŒ‰é’® */\n      .toggle-dialogue-btn {\n        position: absolute;\n        top: -15px;\n        right: -15px;\n        width: 30px;\n        height: 30px;\n        background: white;\n        border-radius: 50%;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n\n      .show-dialogue-hint {\n        position: absolute;\n        bottom: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: rgba(255, 255, 255, 0.5);\n        padding: 8px 16px;\n        border-radius: 20px;\n        cursor: pointer;\n        pointer-events: auto;\n        z-index: 40;\n      }\n      @keyframes flash-green {\n        0% {\n          color: var(--accent-green);\n          transform: scale(1.2);\n        }\n        100% {\n          color: inherit;\n          transform: scale(1);\n        }\n      }\n      @keyframes flash-red {\n        0% {\n          color: var(--accent-red);\n          transform: scale(1.2);\n        }\n        100% {\n          color: inherit;\n          transform: scale(1);\n        }\n      }\n\n      /* --- New Visual Enhancements --- */\n\n      /* 1. Ripple Effect - Updated (Star Shape) */\n      .ripple-container {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        pointer-events: none;\n        z-index: 9999;\n      }\n      .ripple {\n        position: absolute;\n        width: 50px;\n        height: 50px;\n        margin-left: -25px;\n        margin-top: -25px;\n        background: radial-gradient(\n          circle,\n          rgba(255, 255, 255, 0.9) 0%,\n          rgba(212, 160, 23, 0.4) 60%,\n          transparent 100%\n        );\n        /* 4-Point Star / Sparkle Shape */\n        clip-path: polygon(50% 0%, 61% 35%, 100% 50%, 61% 65%, 50% 100%, 39% 65%, 0% 50%, 39% 35%);\n        transform: scale(0) rotate(0deg);\n        animation: ripple-anim 0.8s ease-out;\n        pointer-events: none;\n      }\n      @keyframes ripple-anim {\n        0% {\n          transform: scale(0) rotate(0deg);\n          opacity: 1;\n        }\n        100% {\n          transform: scale(2.5) rotate(45deg);\n          opacity: 0;\n        }\n      }\n\n      /* 2. Dialogue Next Indicator - Amber Triangle */\n      .next-indicator {\n        position: absolute;\n        bottom: 1.8cqw;\n        right: 2.5cqw;\n        width: 1.6cqw;\n        height: 1.6cqw;\n        background-color: var(--accent-amber);\n        clip-path: polygon(0 0, 100% 0, 50% 100%); /* Triangle pointing down */\n        animation: flash-arrow 1.2s infinite ease-in-out;\n        cursor: pointer;\n        filter: drop-shadow(0 0 2px rgba(212, 160, 23, 0.6));\n      }\n      @keyframes flash-arrow {\n        0%,\n        100% {\n          opacity: 0.3;\n          transform: translateY(0);\n        }\n        50% {\n          opacity: 1;\n          transform: translateY(3px);\n        }\n      }\n\n      /* 3. Progress Bar Shine Effect */\n      .progress-shine {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.6) 50%, transparent 100%);\n        transform: translateX(-100%);\n        animation: shine-move 2.5s infinite;\n      }\n      @keyframes shine-move {\n        0% {\n          transform: translateX(-100%);\n        }\n        30% {\n          transform: translateX(100%);\n        }\n        100% {\n          transform: translateX(100%);\n        }\n      }\n\n      /* 4. Juicy UI - Enhanced Button Hovers */\n      .nav-button:active,\n      .item-button:active,\n      .corner-icon:active {\n        transform: scale(0.92) !important;\n      }\n\n      /* å¿ƒé‡Œè¯æ ·å¼ */\n      .inner-thought {\n        color: var(--accent-amber);\n        font-style: italic;\n        opacity: 0.85;\n      }\n\n      /* Decoration for Headers */\n      .rune-text {\n        font-family: var(--font-title);\n        font-size: 0.85em;\n        color: var(--accent-amber);\n        opacity: 0.4;\n        margin-left: auto;\n        pointer-events: none;\n        user-select: none;\n        letter-spacing: 0.1em;\n      }\n    </style>\n  </head>\n  <body>\n    <!-- 2. Hidden Data Container for Safe Injection -->\n    <!-- Using a hidden div avoids syntax errors in JS if the injected text contains quotes or backticks -->\n    <div id=\"st-data-injection\" style=\"display: none\">$1</div>\n\n    <!-- 3. Dev Mode Test Data (Hidden) -->\n    <!-- Moving test data here to avoid '<' characters in JavaScript causing SyntaxErrors -->\n    <div id=\"dev-test-data\" style=\"display: none\">\n      <content>\n        ã€|è´éœ²çš„è™šæ‹Ÿç©ºé—´|è´éœ²|æ—¥å¸¸æœè£…-å¹³é™|ä¸»äººï¼Œä½ å¥½å‘€~æ¬¢è¿å›æ¥ã€‚ã€‘\n        ã€|è´éœ²çš„è™šæ‹Ÿç©ºé—´|è´éœ²|æ—¥å¸¸æœè£…-æ¸©æŸ”å¾®ç¬‘|ä»Šå¤©æƒ³åšäº›ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘éƒ½å¯ä»¥é™ªä½ å“¦ã€‚ã€‘\n        ã€|è´éœ²çš„è™šæ‹Ÿç©ºé—´|è´éœ²|æ—¥å¸¸æœè£…-æ­ªå¤´å¥½å¥‡|å—¯ï¼Ÿä½ åœ¨çœ‹ä»€ä¹ˆå‘€ï¼Œä¸»äººï¼Ÿã€‘\n        ã€|è´éœ²çš„è™šæ‹Ÿç©ºé—´|è´éœ²|æ—¥å¸¸æœè£…-å°æ¶é­”|å˜¿å˜¿~è¢«æˆ‘å‘ç°äº†å§ï¼Ÿã€‘\n        ã€|è´éœ²çš„è™šæ‹Ÿç©ºé—´|è´éœ²|æ—¥å¸¸æœè£…-å®³ç¾|æ‰ã€æ‰æ²¡æœ‰åœ¨æ„ä¸»äººçœ‹æˆ‘å‘¢...ã€‘\n        ã€|è´éœ²çš„è™šæ‹Ÿç©ºé—´|è´éœ²|æ—¥å¸¸æœè£…-åˆ«å¤´å‘+å®³ç¾|*å…¶å®...èƒ½è¢«ä¸»äººæ³¨æ„åˆ°ï¼Œè¿˜æ˜¯æœ‰ä¸€ç‚¹å¼€å¿ƒçš„ã€‚*ã€‘\n      </content>\n      <time>è™šæ‹Ÿç©ºé—´ Â· æ°¸æ’ä¹‹åˆ»</time>\n    </div>\n\n    <div id=\"app\">\n      <div class=\"game-container\" @click=\"createRipple\">\n        <!-- Ripple Container -->\n        <div class=\"ripple-container\">\n          <div v-for=\"r in ripples\" :key=\"r.id\" class=\"ripple\" :style=\"{ left: r.x + 'px', top: r.y + 'px' }\"></div>\n        </div>\n\n        <!-- 2. é¡¶éƒ¨å¯¼èˆª (Top Nav) - ç§»åˆ°æœ€å‰ä»¥ç¡®ä¿å±‚çº§é€»è¾‘ï¼Œé…åˆ absolute å®šä½ -->\n        <div class=\"top-nav\" v-if=\"settings.showUI\" :class=\"{ 'ui-hidden': isDialogueHidden }\">\n          <div class=\"nav-group\">\n            <div class=\"nav-left\">\n              <button class=\"fullscreen-btn\" @click=\"toggleFullscreen\" title=\"å…¨å±åˆ‡æ¢\">\n                <span>â›¶</span>\n              </button>\n              <button\n                class=\"nav-button\"\n                :class=\"{ active: activePopup === 'popup-log' }\"\n                @click=\"togglePopup('popup-log')\"\n                v-if=\"settings.showLog\"\n              >\n                <span>ğŸ“–</span>\n                <img src=\"https://files.catbox.moe/yy2icp.png\" class=\"nav-text-img\" alt=\"Log\" />\n              </button>\n            </div>\n\n            <!-- æ—¶é—´åœ°ç‚¹æ˜¾ç¤º (å±…ä¸­) -->\n            <div class=\"time-location-display\">\n              <div class=\"info-row-top\">\n                {{ state.system.time || 'Loading...' }} &nbsp; {{ state.system.location || '' }}\n              </div>\n              <div class=\"info-row-bottom\" v-if=\"state.system.currentPlot\">{{ state.system.currentPlot }}</div>\n            </div>\n\n            <div class=\"nav-right\">\n              <button\n                class=\"nav-button\"\n                :class=\"{ active: activePopup === 'popup-settings' }\"\n                data-id=\"settings\"\n                @click=\"togglePopup('popup-settings')\"\n              >\n                <span>âš™</span>\n                <img src=\"https://files.catbox.moe/lxm5bv.png\" class=\"nav-text-img\" alt=\"Set\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <!-- 1. ä¸»èˆå° (Center Stage) -->\n        <div\n          class=\"center-stage\"\n          :class=\"{ blurred: activePopup !== null }\"\n          @click=\"handleInteraction\"\n          style=\"cursor: pointer\"\n        >\n          <!-- èƒŒæ™¯å±‚ -->\n          <div class=\"background-layer\" :style=\"backgroundStyle\"></div>\n\n          <!-- è§’è‰²å±‚ -->\n          <div\n            class=\"character-layer\"\n            :class=\"'layout-' + (currentScene && currentScene.sprites ? currentScene.sprites.length : 0)\"\n          >\n            <transition-group name=\"fade\">\n              <img\n                v-for=\"(sprite, index) in (currentScene ? currentScene.sprites : [])\"\n                :key=\"sprite + index\"\n                :src=\"addCatboxPrefix(sprite)\"\n                class=\"character-sprite\"\n                :class=\"{ 'full-body': settings.showFullBody }\"\n                alt=\"Character\"\n                @error=\"handleImageError\"\n              />\n            </transition-group>\n          </div>\n\n          <!-- CGå±‚ (å¦‚æœæœ‰) -->\n          <div\n            class=\"cg-layer\"\n            v-if=\"currentScene && currentScene.cg\"\n            :style=\"{ backgroundImage: `url(${addCatboxPrefix(currentScene.cg)})` }\"\n          ></div>\n        </div>\n\n        <!-- 3. å¯¹è¯æ¡†åŒºåŸŸ -->\n        <div class=\"dialogue-container\" v-if=\"currentScene\" :class=\"{ 'ui-hidden': isDialogueHidden }\">\n          <!-- å¯¹è¯æ¡†æœ¬ä½“ -->\n          <div class=\"dialogue-box\" :class=\"{ hidden: isDialogueHidden }\" @click=\"handleInteraction\">\n            <div class=\"toggle-dialogue-btn\" @click.stop=\"isDialogueHidden = true\">âœ•</div>\n            <div class=\"speaker-name\" v-if=\"currentScene.speaker\">{{ currentScene.speaker }}</div>\n            <div class=\"dialogue-text\" ref=\"dialogueTextRef\">\n              <span v-html=\"displayedMainText\"></span>\n              <div v-if=\"displayedTranslation\" class=\"translation-text\" v-html=\"displayedTranslation\"></div>\n            </div>\n          </div>\n        </div>\n\n        <!-- æ¢å¤å¯¹è¯æ¡†æŒ‰é’® -->\n        <div class=\"show-dialogue-hint\" v-if=\"isDialogueHidden\" @click=\"isDialogueHidden = false\">æ˜¾ç¤ºå¯¹è¯</div>\n\n        <!-- 5. å¼¹å‡ºé¢æ¿å±‚ (Refactored with Components) -->\n        <div class=\"popup-overlay\" v-if=\"activePopup\">\n          <div class=\"popup-backdrop\" @click=\"togglePopup(null)\"></div>\n          <popup-panel\n            :is-active=\"!!activePopup\"\n            :position=\"'top-down'\"\n            :popup-id=\"activePopup\"\n            @close=\"togglePopup(null)\"\n          >\n            <template #title>{{ getPopupTitle(activePopup) }}</template>\n            <template #content>\n              <!-- Log Panel -->\n              <div v-if=\"activePopup === 'popup-log'\">\n                <div style=\"display: flex; justify-content: flex-end; margin-bottom: 10px\">\n                  <button\n                    @click=\"resetGame\"\n                    style=\"\n                      padding: 5px 10px;\n                      background: var(--accent-red);\n                      color: white;\n                      border: none;\n                      border-radius: 5px;\n                      cursor: pointer;\n                    \"\n                  >\n                    é‡ç½®å¯¹è¯\n                  </button>\n                </div>\n                <div v-if=\"state.visualNovel.scenes.length === 0\" class=\"no-data-message\">æš‚æ— è®°å½•</div>\n                <div\n                  v-for=\"(scene, idx) in state.visualNovel.scenes\"\n                  :key=\"idx\"\n                  style=\"\n                    margin-bottom: 15px;\n                    border-bottom: 1px solid #eee;\n                    padding-bottom: 10px;\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: flex-start;\n                  \"\n                >\n                  <div style=\"flex-grow: 1; margin-right: 10px\">\n                    <div style=\"font-weight: bold; color: var(--accent-pink); font-size: 0.9em\">\n                      {{ scene.speaker }}\n                    </div>\n                    <div style=\"color: var(--text-primary)\">{{ scene.text }}</div>\n                  </div>\n                  <button\n                    @click=\"jumpToScene(idx)\"\n                    style=\"\n                      background: transparent;\n                      border: 1px solid var(--accent-blue);\n                      color: var(--accent-blue);\n                      border-radius: 4px;\n                      padding: 2px 8px;\n                      cursor: pointer;\n                      font-size: 0.8em;\n                      white-space: nowrap;\n                    \"\n                    v-if=\"idx <= currentSceneIndex\"\n                  >\n                    è·³è½¬\n                  </button>\n                </div>\n              </div>\n\n              <!-- Settings Panel -->\n              <div v-if=\"activePopup === 'popup-settings'\">\n                <div class=\"switch-row\">\n                  <span>æ˜¾ç¤º Log</span>\n                  <div\n                    class=\"switch-btn\"\n                    :class=\"{ on: settings.showLog }\"\n                    @click=\"settings.showLog = !settings.showLog\"\n                  >\n                    <div class=\"switch-thumb\"></div>\n                  </div>\n                </div>\n                <div class=\"switch-row\">\n                  <span>é€‚åˆå±•ç¤ºè§’è‰²å…¨èº«ç«‹ç»˜</span>\n                  <div\n                    class=\"switch-btn\"\n                    :class=\"{ on: settings.showFullBody }\"\n                    @click=\"settings.showFullBody = !settings.showFullBody\"\n                  >\n                    <div class=\"switch-thumb\"></div>\n                  </div>\n                </div>\n                <div class=\"switch-row\">\n                  <span>éŸ³ä¹</span>\n                  <div\n                    class=\"switch-btn\"\n                    :class=\"{ on: settings.soundEnabled }\"\n                    @click=\"settings.soundEnabled = !settings.soundEnabled\"\n                  >\n                    <div class=\"switch-thumb\"></div>\n                  </div>\n                </div>\n                <div class=\"switch-row\">\n                  <span>éŸ³é‡ ({{ Math.round(settings.volume * 100) }}%)</span>\n                  <div class=\"volume-control\">\n                    <input\n                      type=\"range\"\n                      min=\"0\"\n                      max=\"1\"\n                      step=\"0.01\"\n                      v-model.number=\"settings.volume\"\n                      class=\"volume-slider\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </template>\n          </popup-panel>\n        </div>\n      </div>\n    </div>\n\n    <script>\n      // Global Error Handler to catch syntax or runtime errors preventing Vue from mounting\n      window.onerror = function (message, source, lineno, colno, error) {\n        const errorMsg = `Error: ${message}\\nSource: ${source}:${lineno}:${colno}`;\n        console.error(errorMsg, error);\n        // Only show alert if Vue hasn't mounted (body content is still raw)\n        if (document.getElementById('app') && document.getElementById('app').innerHTML.includes('{{')) {\n          alert('Critical Error: Script failed to run.\\n' + errorMsg);\n        }\n      };\n\n      if (typeof Vue === 'undefined') {\n        alert('Error: Vue.js library not loaded. Please check your internet connection or CDN accessibility.');\n        throw new Error('Vue.js not loaded');\n      }\n\n      const { createApp, ref, reactive, computed, onMounted, watch } = Vue;\n\n      // --- Sprite Mapping ---\n      // è´éœ²æ—¥å¸¸ç«‹ç»˜æ˜ å°„ï¼ˆ24ä¸ªè¡¨æƒ…/åŠ¨ä½œï¼‰\n      // key æ ¼å¼: æ—¥å¸¸æœè£…-è¡¨æƒ…å â†’ catbox ID\n      const CHARACTER_SPRITE_MAP = {\n        \"æ—¥å¸¸æœè£…-å¹³é™\": \"t91hsp\",\n        \"æ—¥å¸¸æœè£…-æ¸©æŸ”å¾®ç¬‘\": \"1agndw\",\n        \"æ—¥å¸¸æœè£…-å¼€å¿ƒ\": \"5y79rh\",\n        \"æ—¥å¸¸æœè£…-æ­ªå¤´å¥½å¥‡\": \"3p31rk\",\n        \"æ—¥å¸¸æœè£…-å°æ¶é­”\": \"g8tfht\",\n        \"æ—¥å¸¸æœè£…-å®³ç¾\": \"aehhgr\",\n        \"æ—¥å¸¸æœè£…-å˜´ç¡¬\": \"hto4ow\",\n        \"æ—¥å¸¸æœè£…-åæ§½\": \"e8wegg\",\n        \"æ—¥å¸¸æœè£…-æƒŠè®¶\": \"s48lny\",\n        \"æ—¥å¸¸æœè£…-èµŒæ°”\": \"5n0721\",\n        \"æ—¥å¸¸æœè£…-è®¤çœŸ\": \"shqe4c\",\n        \"æ—¥å¸¸æœè£…-è¶…çº§å®³ç¾\": \"x1th06\",\n        \"æ—¥å¸¸æœè£…-éš¾è¿‡\": \"jtq99o\",\n        \"æ—¥å¸¸æœè£…-è¦å“­äº†\": \"e70uxa\",\n        \"æ—¥å¸¸æœè£…-å¿ƒç–¼\": \"wz1i98\",\n        \"æ—¥å¸¸æœè£…-å®‰å¿ƒ\": \"46596e\",\n        \"æ—¥å¸¸æœè£…-å›°å€¦\": \"44jb3m\",\n        \"æ—¥å¸¸æœè£…-ç›´ç™½\": \"ry659z\",\n        \"æ—¥å¸¸æœè£…-åŒæ‰‹æ’‘å¼€è¡«ä¸‹æ‘†+å¹³é™\": \"mvdcx5\",\n        \"æ—¥å¸¸æœè£…-æŠ±èƒ¸+åæ§½\": \"t26x0p\",\n        \"æ—¥å¸¸æœè£…-åŒæ‰‹èƒŒå+æ¸©æŸ”å¾®ç¬‘\": \"3behwn\",\n        \"æ—¥å¸¸æœè£…-åˆ«å¤´å‘+å®³ç¾\": \"3w3dyy\",\n        \"æ—¥å¸¸æœè£…-å’¬æŒ‡ç”²+ç´§å¼ \": \"qvhv4c\",\n        \"æ—¥å¸¸æœè£…-è¹²ä¸‹æ‚è†\": \"c4s9fs\",\n      };\n\n      // èƒŒæ™¯æ˜ å°„ï¼ˆé€šç”¨åœºæ™¯ï¼Œå·²ç§»é™¤è§’è‰²/å‰§æƒ…ç‰¹å®šåœºæ™¯ï¼‰\n      const BACKGROUND_MAP = {\n  \"è´éœ²çš„è™šæ‹Ÿç©ºé—´\": \"9f8xxf\",\n  \"ç¥ç¤¾-ç™½å¤©\": \"4ukoga\",\n  \"ç¥ç¤¾-é»„æ˜\": \"cszm5f\",\n  \"ç¥ç¤¾-å¤œæ™š\": \"p9l7t4\",\n  \"æµ·è¾¹-ç™½å¤©\": \"rd4vol\",\n  \"æµ·è¾¹-é»„æ˜\": \"adzcvd\",\n  \"æµ·è¾¹-å¤œæ™š\": \"yhytf9\",\n  \"éƒŠåŒºèŠ±æµ·-é»„æ˜\": \"50358c\",\n  \"éƒŠåŒºèŠ±æµ·-å¤œæ™š\": [\"julbj0\", \"5yfazb\"],\n  \"èŠ±æµ·äº­å­å¤„-ç™½å¤©\": \"0bjzbm\",\n  \"èŠ±æµ·äº­å­å¤„-å¤œæ™š\": \"nqubdd\",\n  \"å°„å‡»å°æ‘Š-ç™½å¤©\": \"ciuabo\",\n  \"å°„å‡»å°æ‘Š-é»„æ˜\": \"xv9wnc\",\n  \"å°„å‡»å°æ‘Š-å¤œæ™š\": \"i9eryy\",\n  \"å–·æ³‰-ç™½å¤©\": \"alzmb3\",\n  \"å–·æ³‰-å¤œæ™š\": \"pq34ek\",\n  \"ç§‹åƒ-é»„æ˜\": \"wo7pka\",\n  \"å°åƒè¡—-ç™½å¤©\": \"2v8bzx\",\n  \"å°åƒè¡—-é»„æ˜\": \"z5xt4d\",\n  \"å°åƒè¡—-å¤œæ™š\": \"h3nfx1\",\n  \"å…¬å›­æ¸¸ç©åŒº-ç™½å¤©\": \"izg175\",\n  \"å…¬å›­æ¸¸ç©åŒº-é»„æ˜\": \"mge2u8\",\n  \"å…¬å›­æ¸¸ç©åŒº-å¤œæ™š\": \"9gsrwm\",\n  \"äººè¡Œé“-ç™½å¤©\": \"89ozi8\",\n  \"åŸå¸‚è¡—é“-ç™½å¤©\": \"f9gdwl\",\n  \"åŸå¸‚è¡—é“-é»„æ˜\": \"iw9rcn\",\n  \"åŸå¸‚è¡—é“-å¤œæ™š\": \"i5f25w\",\n  \"ä¾¿åˆ©åº—-ç™½å¤©\": \"23rpgm\",\n  \"ä¾¿åˆ©åº—-é»„æ˜\": \"ibnnw0\",\n  \"ä¾¿åˆ©åº—-å¤œæ™š\": \"whtmiz\",\n  \"ä¾¿åˆ©åº—-å†…éƒ¨\": \"0pxvgt\",\n  \"è·¯è¾¹å°å–é“º-ç™½å¤©\": \"twi8eg\",\n  \"è·¯è¾¹å°å–é“º-é»„æ˜\": \"l0ukp6\",\n  \"è·¯è¾¹å°å–é“º-å¤œæ™š\": \"olgkl1\",\n  \"è¡—é“äº¤å‰è·¯å£-é»„æ˜\": \"e62trq\",\n  \"è¡—é“äº¤å‰è·¯å£-å¤œæ™š\": \"crpc7f\",\n  \"å±…é…’å±‹\": \"pe3ji4\",\n  \"æ¸©æ³‰-å…¥å£\": \"ue2zmf\",\n  \"æ¸©æ³‰-ç™½å¤©\": \"9lrg9f\",\n  \"æ¸©æ³‰-é»„æ˜\": \"difrtg\",\n  \"æ¸©æ³‰-å¤œæ™š\": \"n6291s\",\n  \"å·¥å‚å…¨æ™¯-ç™½å¤©\": \"1o1scn\",\n  \"å·¥å‚å…¨æ™¯-é»„æ˜\": \"37f1c6\",\n  \"å·¥å‚å…¨æ™¯-å¤œæ™š\": \"t0o5a9\",\n  \"æ¸¯å£-å¤œæ™š\": \"u7ikdg\",\n  \"æ¸¯å£è¾¹çš„æµ·å²¸-ç™½å¤©\": \"mr8l8k\",\n  \"æ¸¯å£è¾¹çš„æµ·å²¸-é»„æ˜\": \"1630k6\",\n  \"æ¸¯å£è¾¹çš„æµ·å²¸-å¤œæ™š\": \"iw96fo\",\n  \"æ²³å·æ•·-ç™½å¤©\": \"0eewjo\",\n  \"æ²³å·æ•·-é»„æ˜2-å”¯ç¾\": \"u5c59l\",\n  \"éƒŠå¤–ä¹¡é—´å°é“-ç™½å¤©\": \"t5seo4\",\n  \"éƒŠå¤–ä¹¡é—´å°é“-é»„æ˜\": \"rfloyn\",\n  \"éƒŠå¤–ä¹¡é—´å°é“-å¤œæ™š\": \"nkvj4q\",\n  \"åŒ»é™¢-ç™½å¤©\": \"roi0oj\",\n  \"åŒ»é™¢-é»„æ˜\": \"zcms0e\",\n  \"åŒ»é™¢-å†…éƒ¨\": \"ttuamz\",\n  \"åœ°é“-å…¥å£\": \"ww0yyb\",\n  \"åœ°é“-ç«™å£\": \"gfsjnf\",\n  \"åœ°é“-é“è½¨-å¤œæ™š\": \"ixg3nu\",\n  \"ä¸Šå­¦é“è·¯-å‰\": \"nd8vry\",\n  \"ä¸Šå­¦é“è·¯-å-æœ‰å°æ²³\": \"n8rupo\",\n  \"ä¸Šå­¦é“è·¯-å2-æ¨±èŠ±\": \"iz7rq6\",\n  \"å­¦é™¢æ“åœº-ç™½å¤©\": \"0xfumj\",\n  \"å­¦é™¢æ“åœº-å‚æ™š\": \"bsmj6r\",\n  \"å­¦é™¢æ“åœº-å¤œæ™š\": \"buhfbj\",\n  \"å­¦æ ¡ä¿å¥å®¤-ç™½å¤©\": \"xdhwos\",\n  \"å­¦æ ¡ä¿å¥å®¤-å‚æ™š\": \"0mvjlr\",\n  \"å­¦æ ¡ä¿å¥å®¤-å¤œæ™š\": \"zoolia\",\n  \"å­¦æ ¡é—¨å£-å‘ä¸Šçœ‹ç™½å¤©\": \"fiw4ub\",\n  \"å­¦æ ¡é—¨å£-ç™½å¤©\": \"7xelvy\",\n  \"å­¦æ ¡é—¨å£-å‚æ™š\": \"ivm26g\",\n  \"æ•™å®¤ç›¸å…³-æ•™å®¤å†…\": \"zhd2bz\",\n  \"æ•™å®¤ç›¸å…³-æ•™å®¤å¤–\": \"jxg8i6\",\n  \"æ¨±èŠ±èµ°é“-ç™½å¤©\": \"080o4n\",\n  \"æ¨±èŠ±èµ°é“-å‚æ™š\": \"pn7y8g\",\n  \"æ¨±èŠ±èµ°é“-å¤œæ™š\": \"vm37bw\",\n  \"å­¦æ ¡é£Ÿå ‚-ç™½å¤©\": \"02ehcr\",\n  \"å­¦æ ¡é£Ÿå ‚-å‚æ™š\": \"wxjdnj\",\n  \"å­¦æ ¡å±‹é¡¶-ç™½å¤©\": \"mtkopp\",\n  \"å­¦æ ¡å±‹é¡¶-é»„æ˜\": \"4oktrd\",\n  \"å­¦æ ¡å°å–é“º\": \"61rvcr\",\n  \"å›¾ä¹¦é¦†-ç™½å¤©\": \"yu2z29\",\n  \"å›¾ä¹¦é¦†-å‚æ™š\": \"w5rh9s\",\n  \"å›¾ä¹¦é¦†-å¤œæ™š\": \"9ud8pe\",\n  \"å­¦æ ¡èµ°å»Š-å‰è¿‡é“\": \"kfcau9\",\n  \"å­¦æ ¡èµ°å»Š-ç»ç’ƒèµ°å»Šå†…éƒ¨\": \"c3lsrq\",\n  \"å­¦æ ¡èµ°å»Š-å¤–éƒ¨è§†ç‚¹\": \"z7u9c0\",\n  \"å•†åŸå†…éƒ¨-å¤§å…\": \"w9nyrb\",\n  \"å•†åŸå†…éƒ¨-è¿‡é“\": \"hk1x0n\",\n  \"å•†åŸå†…éƒ¨-è·³èˆæœº\": \"2r57pz\",\n  \"é¤å…\": \"eegvzw\",\n  \"å•†ä¸šè¡—-ç™½å¤©\": \"c884dj\",\n  \"å•†ä¸šè¡—-å‚æ™š\": \"ub8wmh\",\n  \"å•†ä¸šè¡—-å¤œæ™š\": \"i9fdih\",\n  \"åº—é“ºå†…éƒ¨-è¶…å¸‚å†…\": \"sifo74\",\n  \"æµ´å®¤-å¼€ç¯-æœ‰æ°´\": \"891t35\",\n  \"æµ´å®¤-å¼€ç¯-æ— æ°´\": \"1fhkdg\",\n  \"é…’åº—æˆ¿é—´\": \"pv4ioo\",\n};\n\n      const CG_MAP = {\n};\n\n      function resolveSprite(key) {\n        if (!key) return key;\n        const mapped = CHARACTER_SPRITE_MAP[key];\n        if (!mapped) return key; // Return original if not found (e.g. direct ID or unmapped)\n\n        if (Array.isArray(mapped)) {\n          // Randomly select one\n          return mapped[Math.floor(Math.random() * mapped.length)];\n        }\n        return mapped;\n      }\n\n      function resolveBackground(key) {\n        if (!key) return key;\n        // Remove comments for lookup\n        const cleanKey = key.replace(/ï¼ˆ.*?ï¼‰|\\(.*?\\)/g, '').trim();\n\n        // Try Background Map first\n        let mapped = BACKGROUND_MAP[cleanKey];\n\n        // If not found, try CG Map\n        if (!mapped) {\n          mapped = CG_MAP[cleanKey];\n        }\n\n        if (!mapped) return key; // Return original if not found\n\n        if (Array.isArray(mapped)) {\n          return mapped[Math.floor(Math.random() * mapped.length)];\n        }\n        return mapped;\n      }\n\n      // --- Parser Logic ---\n      function parseGameTxt(rawText) {\n        const contentMatch = rawText.match(/<content>([\\s\\S]*?)<\\/content>/);\n        const statusMatch = rawText.match(/<status>([\\s\\S]*?)<\\/status>/);\n        const bgmMatch = rawText.match(/<bgm_text>([\\s\\S]*?)<\\/bgm_text>/);\n        const timeMatch = rawText.match(/<time>([\\s\\S]*?)<\\/time>/);\n\n        const initialState = {\n          visualNovel: { scenes: [] },\n          system: {},\n          bgm: bgmMatch ? bgmMatch[1].trim() : null,\n        };\n\n        // è§£æ <time> æ ‡ç­¾\n        if (timeMatch) {\n          initialState.system.time = timeMatch[1].trim();\n        }\n\n        if (contentMatch) {\n          const contentText = contentMatch[1].trim();\n          // Regex to match content inside ã€...ã€‘ and optional following translation in ( )\n          // Updated to be more robust for newlines and various bracket types\n          // Also supports translation immediately following the closing bracket ã€‘(translation)\n          const sceneRegex = /ã€(.*?)ã€‘(?:\\s*[\\(ï¼ˆ]([\\s\\S]*?)[\\)ï¼‰])?/g;\n          let match;\n          while ((match = sceneRegex.exec(contentText)) !== null) {\n            let rawContent = match[1];\n            let externalTranslation = match[2]; // Captured translation outside brackets\n\n            // Remove leading separator if present\n            if (rawContent.startsWith('|') || rawContent.startsWith('ï½œ')) {\n              rawContent = rawContent.substring(1);\n            }\n\n            // Split by separator\n            const parts = rawContent.split(/[\\|ï½œ]/).map(p => p.trim());\n\n            let scene = { bg: '', speaker: '', sprites: [], text: '', translation: '' };\n\n            // Assign external translation if captured\n            if (externalTranslation) {\n              scene.translation = externalTranslation.trim();\n            }\n\n            // Robust Parsing Logic\n            if (parts.length >= 4) {\n              // Format: BG | Speaker | Sprite(s)... | Text\n              scene.bg = resolveBackground(parts[0]);\n              scene.speaker = parts[1];\n              scene.text = parts[parts.length - 1];\n              // Extract all parts between speaker and text as sprites\n              scene.sprites = parts\n                .slice(2, parts.length - 1)\n                .filter(s => s.trim())\n                .map(s => {\n                  const raw = s.trim();\n                  // Remove comments in parentheses for lookup key\n                  const key = raw.replace(/ï¼ˆ.*?ï¼‰|\\(.*?\\)/g, '').trim();\n                  const mapped = resolveSprite(key);\n                  // If mapped is different from key, it means we found a mapping.\n                  // If mapped is same as key, it means no mapping found, so return raw (to keep original comments if any)\n                  return mapped !== key ? mapped : raw;\n                });\n            } else if (parts.length === 3) {\n              // Format: BG | Speaker | Text (Sprite omitted)\n              scene.bg = resolveBackground(parts[0]);\n              scene.speaker = parts[1];\n              scene.text = parts[2];\n            } else if (parts.length === 2) {\n              // Format: Speaker | Text (BG and Sprite omitted, e.g. TTS format)\n              // Or: BG | Text (Speaker omitted - e.g. narration with BG)\n              // Heuristic: If first part looks like a filename (has extension), treat as BG\n              // Also check if it matches a background key\n              const potentialBg = parts[0].replace(/ï¼ˆ.*?ï¼‰|\\(.*?\\)/g, '').trim();\n              if (parts[0].match(/\\.(png|jpg|jpeg|gif|webp)$/i) || BACKGROUND_MAP[potentialBg]) {\n                scene.bg = resolveBackground(parts[0]);\n                scene.speaker = ''; // Narration\n                scene.text = parts[1];\n              } else {\n                scene.speaker = parts[0];\n                scene.text = parts[1];\n              }\n            } else if (parts.length === 1) {\n              // Fallback: Just Text\n              scene.text = parts[0];\n            }\n\n            // Clean up text (remove TTS tags if any remain)\n            if (scene.text) {\n              scene.text = scene.text.replace(/<npc\\d+>|<\\/npc\\d+>/g, '');\n\n              // Handle translation in parentheses: \"Japanese text (Chinese translation)\"\n              // Regex looks for content ending with (text) or ï¼ˆtextï¼‰\n              // It captures the main text in group 1 (greedy) and the translation in group 2\n              // Using greedy match (.*) for the first part ensures we capture the LAST parenthesized block\n              const translationMatch = scene.text.match(/^(.*)[\\(ï¼ˆ](.*?)[\\)ï¼‰]\\s*$/);\n              if (translationMatch) {\n                const mainText = translationMatch[1].trim();\n                const internalTranslation = translationMatch[2].trim();\n\n                scene.text = mainText;\n                // If we already have an external translation, maybe append? Or overwrite?\n                // Usually it's one or the other. Let's prefer the internal one if it exists, or join them.\n                if (scene.translation) {\n                  scene.translation += ' ' + internalTranslation;\n                } else {\n                  scene.translation = internalTranslation;\n                }\n              }\n            }\n\n            initialState.visualNovel.scenes.push(scene);\n          }\n        }\n\n        if (statusMatch) {\n          const lines = statusMatch[1].trim().split(/\\r?\\n/);\n          let currentSection = null;\n          let currentObj = null;\n          let lastKey = null;\n\n          const sectionMap = {\n            ç³»ç»Ÿ: 'system',\n            ç”¨æˆ·çš„çŠ¶æ€: 'userStatus',\n            ç”¨æˆ·èƒŒåŒ…: 'userInventory',\n            æˆ˜æ–—ç‰ˆå—: 'combat',\n            åŒä¼´çŠ¶æ€: 'companions',\n            æ•Œäºº: 'enemies',\n            é­”æ³•å°‘å¥³å°è´´å£«: 'tips',\n          };\n\n          for (let line of lines) {\n            line = line.trim();\n            if (!line) continue;\n\n            if (sectionMap[line]) {\n              currentSection = sectionMap[line];\n              currentObj = null;\n              lastKey = null;\n              continue;\n            }\n\n            if (!currentSection) continue;\n\n            if (currentSection === 'tips') {\n              const parts = line.split(/[:ï¼š](.*)/s);\n              const tip = { comment: 'é­”æ³•é¡¾é—®', option: line, clickable: true };\n              if (parts.length > 1 && parts[1] && parts[1].trim()) {\n                tip.comment = parts[0].trim();\n                tip.option = parts[1].trim();\n              }\n              if (tip.option.includes('æš‚æ— å»ºè®®') || tip.option === 'æ— ') tip.clickable = false;\n              initialState.tips.push(tip);\n              continue;\n            }\n\n            if (currentSection === 'companions' && line.toLowerCase().startsWith('npc')) {\n              currentObj = { id: Date.now() + Math.random() };\n              initialState.companions.push(currentObj);\n              continue;\n            }\n            if (currentSection === 'enemies' && line.startsWith('åå­—')) {\n              currentObj = {};\n              initialState.enemies.push(currentObj);\n            }\n\n            let target = currentObj;\n            if (!target) {\n              if (currentSection === 'system') target = initialState.system;\n              else if (currentSection === 'userStatus') target = initialState.userStatus;\n              else if (currentSection === 'userInventory') target = initialState.userInventory;\n              else if (currentSection === 'combat') target = initialState.combat;\n            }\n\n            if (!target) continue;\n\n            const parts = line.split(/[:ï¼š](.*)/s);\n            if (parts.length >= 2) {\n              const key = parts[0].trim();\n              const val = parts[1].trim();\n\n              let internalKey = key;\n              if (key === 'æ—¶é—´') internalKey = 'time';\n              else if (key === 'åœ°ç‚¹') internalKey = 'location';\n              else if (key === 'è½®å›æ¬¡æ•°') internalKey = 'loopCount';\n              else if (key === 'è½®å›å¤©æ•°') internalKey = 'loopDays';\n              else if (key === 'ç°åœ¨æ—¶é—´æ®µåŸå‰§æƒ…') internalKey = 'currentPlot';\n              else if (key === 'ä½“åŠ›å€¼' || key === 'ç”Ÿå‘½å€¼') internalKey = 'hp';\n              else if (key === 'é­”æ³•å€¼') internalKey = 'mp';\n              else if (key === 'çµé­‚çº¯å‡€åº¦') internalKey = 'soulPurity';\n              else if (key === 'æœè£…') internalKey = 'clothing';\n              else if (key === 'å½“å‰èº«ä½“çŠ¶æ€') internalKey = 'condition';\n              else if (key === 'å½“å‰åŠ¨ä½œ') internalKey = 'action';\n              else if (key === 'æ‚²å¹ä¹‹ç§') internalKey = 'griefSeeds';\n              else if (key === 'èƒŒåŒ…ç‰©å“') {\n                internalKey = 'items';\n                target[internalKey] = [];\n              } else if (key === 'é­”æ³•æŠ€èƒ½') {\n                internalKey = 'skills';\n                target[internalKey] = [];\n              } else if (key === 'æ­¦å™¨') {\n                internalKey = 'weapon';\n                target[internalKey] = [];\n              } else if (key === 'å§“å' || key === 'åå­—') internalKey = 'name';\n              else if (key === 'å¥½æ„Ÿåº¦') internalKey = 'affection';\n              else if (key === 'å†…å¿ƒæƒ³æ³•') internalKey = 'thoughts';\n              else if (key === 'ç‰¹æ®Šæœºåˆ¶') internalKey = 'mechanics';\n\n              if (internalKey === 'items' || internalKey === 'skills' || internalKey === 'weapon') {\n                if (val) target[internalKey].push(val);\n                lastKey = internalKey;\n              } else {\n                target[internalKey] = val;\n                lastKey = internalKey;\n              }\n            } else if (lastKey && (lastKey === 'items' || lastKey === 'skills' || lastKey === 'weapon')) {\n              target[lastKey].push(line);\n            }\n          }\n        }\n\n        return initialState;\n      }\n\n      const app = createApp({\n        setup() {\n          const state = reactive({\n            visualNovel: { scenes: [] },\n            system: {},\n            bgm: null,\n          });\n\n          const settings = reactive({\n            showUI: true,\n            showLog: true,\n            showFullBody: false,\n            soundEnabled: true,\n            volume: 0.5,\n          });\n\n          const activePopup = ref(null);\n          const isDialogueHidden = ref(false);\n          const currentSceneIndex = ref(0);\n          const displayedMainText = ref('');\n          const displayedTranslation = ref('');\n          const isTyping = ref(false);\n          const finishTyping = ref(false);\n          const audioPlayer = ref(new Audio());\n\n          // Visual Effects State\n          const ripples = ref([]);\n\n          const dialogueTextRef = ref(null);\n          audioPlayer.value.loop = true;\n\n          // --- Computed ---\n          const currentScene = computed(() => {\n            if (state.visualNovel.scenes.length > 0 && currentSceneIndex.value < state.visualNovel.scenes.length) {\n              return state.visualNovel.scenes[currentSceneIndex.value];\n            }\n            return null;\n          });\n\n          const backgroundStyle = computed(() => {\n            const url = currentScene.value?.bg\n              ? addCatboxPrefix(currentScene.value.bg)\n              : 'https://files.catbox.moe/julbj0.png';\n            return { backgroundImage: `url(${url})` };\n          });\n\n          // --- Methods ---\n          const addCatboxPrefix = url => {\n            if (!url) return '';\n            if (url.startsWith('http')) return url;\n            // Remove comments in parentheses (e.g. \"julbj0.png(cgå›¾ç‰‡)\")\n            let cleanId = url.replace(/ï¼ˆ.*?ï¼‰|\\(.*?\\)/g, '').trim();\n\n            // Auto-complete extension if missing (default to .png)\n            if (!cleanId.match(/\\.[a-zA-Z0-9]+$/)) {\n              cleanId += '.png';\n            }\n\n            return `https://files.catbox.moe/${cleanId}`;\n          };\n\n          const handleImageError = e => {\n            e.target.style.display = 'none';\n          };\n\n          const createRipple = e => {\n            // Get coordinates relative to the container\n            const rect = e.currentTarget.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            const y = e.clientY - rect.top;\n\n            const id = Date.now();\n            ripples.value.push({ id, x, y });\n\n            // Remove ripple after animation\n            setTimeout(() => {\n              ripples.value = ripples.value.filter(r => r.id !== id);\n            }, 600);\n          };\n\n          // é¢„å¤„ç†æ–‡æœ¬ï¼šå°† *xxx* è½¬æ¢ä¸º <span class=\"inner-thought\">xxx</span>\n          const processThoughts = str => {\n            if (!str) return str;\n            return str.replace(/\\*(.*?)\\*/g, '<span class=\"inner-thought\">' + '$' + '1' + '</span>');\n          };\n\n          // HTML æ„ŸçŸ¥çš„æ‰“å­—æœºï¼šé‡åˆ° < æ ‡ç­¾æ—¶æ•´ä½“è¾“å‡ºï¼Œä¸é€å­—æ‹†åˆ†\n          const typeTextWithHtml = async (processed, targetRef, delay) => {\n            let i = 0;\n            while (i < processed.length) {\n              if (finishTyping.value) {\n                targetRef.value = processed;\n                break;\n              }\n              if (processed[i] === '<') {\n                // æ‰¾åˆ°æ ‡ç­¾ç»“æŸä½ç½®ï¼Œæ•´ä½“è¾“å‡º\n                const closeIdx = processed.indexOf('>', i);\n                if (closeIdx !== -1) {\n                  targetRef.value += processed.substring(i, closeIdx + 1);\n                  i = closeIdx + 1;\n                } else {\n                  targetRef.value += processed[i];\n                  i++;\n                }\n              } else {\n                targetRef.value += processed[i];\n                i++;\n                await new Promise(r => setTimeout(r, delay));\n              }\n            }\n          };\n\n          const typeWriter = async (text, translation) => {\n            isTyping.value = true;\n            finishTyping.value = false;\n            displayedMainText.value = '';\n            displayedTranslation.value = '';\n\n            const processedText = processThoughts(text);\n            const processedTranslation = processThoughts(translation);\n\n            // Type Main Text\n            if (processedText) {\n              await typeTextWithHtml(processedText, displayedMainText, 30);\n            }\n\n            // Type Translation (if exists)\n            if (processedTranslation) {\n              await typeTextWithHtml(processedTranslation, displayedTranslation, 20);\n            }\n\n            isTyping.value = false;\n            finishTyping.value = false;\n\n            // Auto-scroll\n            if (dialogueTextRef.value) {\n              dialogueTextRef.value.scrollTop = dialogueTextRef.value.scrollHeight;\n            }\n          };\n\n          const handleInteraction = () => {\n            if (isTyping.value) {\n              finishTyping.value = true;\n            } else {\n              nextScene();\n            }\n          };\n\n          const nextScene = () => {\n            if (currentSceneIndex.value < state.visualNovel.scenes.length - 1) {\n              currentSceneIndex.value++;\n            }\n          };\n\n          const jumpToScene = index => {\n            if (index >= 0 && index < state.visualNovel.scenes.length) {\n              currentSceneIndex.value = index;\n              activePopup.value = null; // Close log panel\n            }\n          };\n\n          const resetGame = () => {\n            if (confirm('ç¡®å®šè¦é‡ç½®å¯¹è¯è¿›åº¦å—ï¼Ÿ')) {\n              currentSceneIndex.value = 0;\n              activePopup.value = null;\n            }\n          };\n\n          const toggleFullscreen = () => {\n            if (!document.fullscreenElement) {\n              document.documentElement.requestFullscreen().catch(e => console.log(e));\n            } else {\n              document.exitFullscreen();\n            }\n          };\n\n          const togglePopup = id => {\n            activePopup.value = activePopup.value === id ? null : id;\n          };\n\n          const getPopupTitle = id => {\n            const titles = {\n              'popup-log': 'å¯¹è¯å†å²',\n              'popup-settings': 'ç³»ç»Ÿè®¾ç½®',\n            };\n            return titles[id] || 'ä¿¡æ¯';\n          };\n\n          const sendAsChatMessage = async msg => {\n            if (typeof createChatMessages === 'function' && typeof triggerSlash === 'function') {\n              try {\n                await createChatMessages([{ role: 'user', message: msg }]);\n                triggerSlash('/trigger');\n                return;\n              } catch (e) {\n                console.error('Global API failed', e);\n              }\n            }\n            try {\n              const st = window.SillyTavern || (window.parent && window.parent.SillyTavern);\n              if (st) {\n                await st.createChatMessages([{ role: 'user', message: msg }]);\n                st.triggerSlash('/trigger');\n                return;\n              }\n            } catch (e) {\n              console.error('ST Object API failed:', e);\n            }\n            console.log('æ¨¡æ‹Ÿå‘é€:', msg);\n          };\n\n          // --- Watchers ---\n          watch(currentScene, newVal => {\n            if (newVal) typeWriter(newVal.text, newVal.translation);\n          });\n\n          watch(\n            () => state.bgm,\n            newBgm => {\n              if (newBgm) {\n                const url = addCatboxPrefix(newBgm);\n                if (audioPlayer.value.src !== url) {\n                  audioPlayer.value.src = url;\n                  if (settings.soundEnabled) {\n                    audioPlayer.value.play().catch(e => console.warn('Auto-play blocked:', e));\n                  }\n                }\n              } else {\n                audioPlayer.value.pause();\n              }\n            },\n          );\n\n          watch(\n            () => settings.soundEnabled,\n            enabled => {\n              if (enabled) {\n                if (state.bgm && audioPlayer.value.src) audioPlayer.value.play().catch(e => console.warn(e));\n              } else {\n                audioPlayer.value.pause();\n              }\n            },\n          );\n\n          watch(\n            () => settings.volume,\n            newVol => {\n              audioPlayer.value.volume = newVol;\n            },\n          );\n\n          // --- Lifecycle ---\n          onMounted(() => {\n            // Load settings from localStorage\n            const savedSettings = localStorage.getItem('beiluSettings');\n            if (savedSettings) {\n              try {\n                Object.assign(settings, JSON.parse(savedSettings));\n              } catch (e) {\n                console.error('Failed to load settings:', e);\n              }\n            }\n\n            // Apply initial volume\n            audioPlayer.value.volume = settings.volume;\n\n            // Watch settings and save to localStorage\n            watch(\n              settings,\n              newSettings => {\n                localStorage.setItem('beiluSettings', JSON.stringify(newSettings));\n              },\n              { deep: true },\n            );\n\n            let dataToParse = '';\n\n            // 1. Try SillyTavern Global API\n            if (typeof window.getCurrentMessageId === 'function' && typeof window.getChatMessages === 'function') {\n              try {\n                const msgId = window.getCurrentMessageId();\n                const msgs = window.getChatMessages(msgId);\n                if (msgs && msgs.length > 0) {\n                  const msgContent = msgs[0].message;\n                  if (msgContent && (msgContent.includes('<content>') || msgContent.includes('<status>'))) {\n                    dataToParse = msgContent;\n                    console.log('Loaded data via ST API');\n                  }\n                }\n              } catch (e) {\n                console.warn('ST API data fetch failed:', e);\n              }\n            }\n\n            // 2. Fallback: Regex Injection\n            if (!dataToParse) {\n              const injectionEl = document.getElementById('st-data-injection');\n              const rawInjection = injectionEl ? injectionEl.innerText : '';\n              const placeholder = '$' + '1';\n              if (rawInjection && rawInjection.trim() !== placeholder) {\n                dataToParse = rawInjection;\n                console.log('Loaded injected data');\n              }\n            }\n\n            // 3. Fallback: Dev Mode\n            if (!dataToParse) {\n              console.log('Loaded test data (Dev Mode)');\n              const devDataEl = document.getElementById('dev-test-data');\n              if (devDataEl) {\n                dataToParse = devDataEl.innerHTML;\n              }\n            }\n\n            if (dataToParse) {\n              const parsed = parseGameTxt(dataToParse);\n              Object.assign(state, parsed);\n              // Watcher will handle the initial typeWriter call\n            }\n          });\n\n          return {\n            state,\n            settings,\n            activePopup,\n            isDialogueHidden,\n            currentScene,\n            currentSceneIndex,\n            displayedMainText,\n            displayedTranslation,\n            isTyping,\n            backgroundStyle,\n            addCatboxPrefix,\n            handleImageError,\n            nextScene,\n            togglePopup,\n            getPopupTitle,\n            sendAsChatMessage,\n            handleInteraction,\n            jumpToScene,\n            resetGame,\n            toggleFullscreen,\n            createRipple,\n            ripples,\n            dialogueTextRef,\n          };\n        },\n      });\n\n      // --- Components ---\n      app.component('progress-bar', {\n        props: {\n          value: [String, Number],\n          max: { type: Number, default: 100 },\n          color: String,\n          textColor: { type: String, default: '#fff' },\n        },\n        setup(props) {\n          const animatedValue = ref(0);\n          const displayValue = computed(() => Math.round(animatedValue.value));\n          const percentage = computed(() => (animatedValue.value / props.max) * 100);\n\n          watch(\n            () => props.value,\n            newValue => {\n              if (typeof gsap !== 'undefined') {\n                gsap.to(animatedValue, { duration: 0.8, value: parseFloat(newValue) || 0, ease: 'power2.out' });\n              } else {\n                animatedValue.value = parseFloat(newValue) || 0;\n              }\n            },\n            { immediate: true },\n          );\n\n          return { displayValue, percentage };\n        },\n        template: `\n          <div class=\"progress-container\" style=\"height: 18px; border-radius: 9px; position: relative; background: rgba(0,0,0,0.1); overflow: hidden;\">\n            <div class=\"progress-fill\" :style=\"{ width: percentage + '%', background: color, borderRadius: '9px', position: 'relative', overflow: 'hidden' }\">\n                <div class=\"progress-shine\"></div>\n            </div>\n            <span style=\"position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 0.75em; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.5); z-index: 2;\" :style=\"{ color: textColor }\">\n              {{ displayValue }} / {{ max }}\n            </span>\n          </div>\n        `,\n      });\n\n      app.component('popup-panel', {\n        props: ['isActive', 'position', 'popupId'],\n        emits: ['close'],\n        template: `\n        <div class=\"popup-panel\" :class=\"[position, popupId]\">\n            <div class=\"popup-header\">\n                <h3 class=\"popup-title\"><slot name=\"title\"></slot></h3>\n                <span class=\"rune-text\">âœ¦ BEILU âœ¦</span>\n                <button class=\"popup-close\" @click=\"$emit('close')\">&times;</button>\n            </div>\n            <div class=\"popup-content\"><slot name=\"content\"></slot></div>\n        </div>\n    `,\n      });\n\n      if (typeof $ !== 'undefined') {\n        $(() => {\n          app.mount('#app');\n        });\n      } else {\n        app.mount('#app');\n      }\n    </script>\n  </body>\n</html>\n```",
      "trimStrings": "",
      "placement": [
        2
      ],
      "disabled": false,
      "runOnEdit": true,
      "substituteRegex": 0,
      "minDepth": -1,
      "maxDepth": 2,
      "markdownOnly": true,
      "promptOnly": false,
      "scope": "scoped",
      "boundCharName": "è´éœ²"
    },
    {
      "id": "mlsxy08sfm45q",
      "scriptName": "beiluçš„ç«‹ç»˜å‚¨å­˜",
      "findRegex": "",
      "replaceString": "https://files.catbox.moe/0bjzbm.png\nhttps://files.catbox.moe/0eewjo.png\nhttps://files.catbox.moe/0mvjlr.png\nhttps://files.catbox.moe/0pxvgt.png\nhttps://files.catbox.moe/0xfumj.png\nhttps://files.catbox.moe/02ehcr.png\nhttps://files.catbox.moe/080o4n.png\nhttps://files.catbox.moe/1630k6.png\nhttps://files.catbox.moe/1fhkdg.png\nhttps://files.catbox.moe/1o1scn.png\nhttps://files.catbox.moe/23rpgm.png\nhttps://files.catbox.moe/2r57pz.png\nhttps://files.catbox.moe/2v8bzx.png\nhttps://files.catbox.moe/37f1c6.png\nhttps://files.catbox.moe/4oktrd.png\nhttps://files.catbox.moe/4ukoga.png\nhttps://files.catbox.moe/50358c.png\nhttps://files.catbox.moe/5yfazb.png\nhttps://files.catbox.moe/61rvcr.png\nhttps://files.catbox.moe/7xelvy.png\nhttps://files.catbox.moe/89ozi8.png\nhttps://files.catbox.moe/891t35.png\nhttps://files.catbox.moe/9f8xxf.png\nhttps://files.catbox.moe/9gsrwm.png\nhttps://files.catbox.moe/9lrg9f.png\nhttps://files.catbox.moe/9ud8pe.png\nhttps://files.catbox.moe/adzcvd.png\nhttps://files.catbox.moe/alzmb3.png\nhttps://files.catbox.moe/bsmj6r.png\nhttps://files.catbox.moe/buhfbj.png\nhttps://files.catbox.moe/c3lsrq.png\nhttps://files.catbox.moe/c884dj.png\nhttps://files.catbox.moe/ciuabo.png\nhttps://files.catbox.moe/crpc7f.png\nhttps://files.catbox.moe/cszm5f.png\nhttps://files.catbox.moe/difrtg.png\nhttps://files.catbox.moe/e62trq.png\nhttps://files.catbox.moe/eegvzw.png\nhttps://files.catbox.moe/f9gdwl.png\nhttps://files.catbox.moe/fiw4ub.png\nhttps://files.catbox.moe/gfsjnf.png\nhttps://files.catbox.moe/h3nfx1.png\nhttps://files.catbox.moe/hk1x0n.png\nhttps://files.catbox.moe/i5f25w.png\nhttps://files.catbox.moe/i9eryy.png\nhttps://files.catbox.moe/i9fdih.png\nhttps://files.catbox.moe/ibnnw0.png\nhttps://files.catbox.moe/ivm26g.png\nhttps://files.catbox.moe/iw96fo.png\nhttps://files.catbox.moe/iw9rcn.png\nhttps://files.catbox.moe/ixg3nu.png\nhttps://files.catbox.moe/iz7rq6.png\nhttps://files.catbox.moe/izg175.png\nhttps://files.catbox.moe/julbj0.png\nhttps://files.catbox.moe/jxg8i6.png\nhttps://files.catbox.moe/kfcau9.png\nhttps://files.catbox.moe/l0ukp6.png\nhttps://files.catbox.moe/mge2u8.png\nhttps://files.catbox.moe/mr8l8k.png\nhttps://files.catbox.moe/mtkopp.png\nhttps://files.catbox.moe/n6291s.png\nhttps://files.catbox.moe/n8rupo.png\nhttps://files.catbox.moe/nd8vry.png\nhttps://files.catbox.moe/nkvj4q.png\nhttps://files.catbox.moe/nqubdd.png\nhttps://files.catbox.moe/olgkl1.png\nhttps://files.catbox.moe/p9l7t4.png\nhttps://files.catbox.moe/pe3ji4.png\nhttps://files.catbox.moe/pn7y8g.png\nhttps://files.catbox.moe/pq34ek.png\nhttps://files.catbox.moe/pv4ioo.png\nhttps://files.catbox.moe/rd4vol.png\nhttps://files.catbox.moe/rfloyn.png\nhttps://files.catbox.moe/roi0oj.png\nhttps://files.catbox.moe/sifo74.png\nhttps://files.catbox.moe/t0o5a9.png\nhttps://files.catbox.moe/t5seo4.png\nhttps://files.catbox.moe/ttuamz.png\nhttps://files.catbox.moe/twi8eg.png\nhttps://files.catbox.moe/u5c59l.png\nhttps://files.catbox.moe/u7ikdg.png\nhttps://files.catbox.moe/ub8wmh.png\nhttps://files.catbox.moe/ue2zmf.png\nhttps://files.catbox.moe/vm37bw.png\nhttps://files.catbox.moe/w5rh9s.png\nhttps://files.catbox.moe/w9nyrb.png\nhttps://files.catbox.moe/whtmiz.png\nhttps://files.catbox.moe/wo7pka.png\nhttps://files.catbox.moe/ww0yyb.png\nhttps://files.catbox.moe/wxjdnj.png\nhttps://files.catbox.moe/xdhwos.png\nhttps://files.catbox.moe/xv9wnc.png\nhttps://files.catbox.moe/yhytf9.png\nhttps://files.catbox.moe/yu2z29.png\nhttps://files.catbox.moe/z5xt4d.png\nhttps://files.catbox.moe/z7u9c0.png\nhttps://files.catbox.moe/zcms0e.png\nhttps://files.catbox.moe/zhd2bz.png\nhttps://files.catbox.moe/zoolia.png\nhttps://files.catbox.moe/1agndw.png\nhttps://files.catbox.moe/3behwn.png\nhttps://files.catbox.moe/3p31rk.png\nhttps://files.catbox.moe/3w3dyy.png\nhttps://files.catbox.moe/44jb3m.png\nhttps://files.catbox.moe/46596e.png\nhttps://files.catbox.moe/5n0721.png\nhttps://files.catbox.moe/5y79rh.png\nhttps://files.catbox.moe/aehhgr.png\nhttps://files.catbox.moe/c4s9fs.png\nhttps://files.catbox.moe/e70uxa.png\nhttps://files.catbox.moe/e8wegg.png\nhttps://files.catbox.moe/g8tfht.png\nhttps://files.catbox.moe/hto4ow.png\nhttps://files.catbox.moe/jtq99o.png\nhttps://files.catbox.moe/mvdcx5.png\nhttps://files.catbox.moe/qvhv4c.png\nhttps://files.catbox.moe/ry659z.png\nhttps://files.catbox.moe/s48lny.png\nhttps://files.catbox.moe/shqe4c.png\nhttps://files.catbox.moe/t26x0p.png\nhttps://files.catbox.moe/t91hsp.png\nhttps://files.catbox.moe/wz1i98.png\nhttps://files.catbox.moe/x1th06.png",
      "trimStrings": "",
      "placement": [],
      "disabled": false,
      "runOnEdit": false,
      "substituteRegex": 0,
      "minDepth": -1,
      "maxDepth": 0,
      "markdownOnly": false,
      "promptOnly": false,
      "scope": "scoped",
      "boundCharName": "è´éœ²"
    },
    {
      "id": "mlsxy08su9w7l",
      "scriptName": "éšè—",
      "findRegex": "<timer>([\\s\\S]*?)<\\/timer>",
      "replaceString": "",
      "trimStrings": "",
      "placement": [
        1,
        2
      ],
      "disabled": false,
      "runOnEdit": true,
      "substituteRegex": 0,
      "minDepth": -1,
      "maxDepth": 0,
      "markdownOnly": true,
      "promptOnly": false,
      "scope": "scoped",
      "boundCharName": "è´éœ²"
    },
    {
      "id": "mlsxy08sikb2v",
      "scriptName": "éšè—æ”»å‡»",
      "findRegex": "/<attack>[\\s\\S]*?<\\/attack>/gs",
      "replaceString": "",
      "trimStrings": "",
      "placement": [
        1,
        2
      ],
      "disabled": false,
      "runOnEdit": true,
      "substituteRegex": 0,
      "minDepth": -1,
      "maxDepth": 0,
      "markdownOnly": true,
      "promptOnly": false,
      "scope": "scoped",
      "boundCharName": "è´éœ²"
    }
  ],
  "enabled": true,
  "renderMode": "sandbox"
}