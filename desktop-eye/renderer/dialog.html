<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è´éœ²çš„çœ¼ç› â€” å‘é€æˆªå›¾</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
	width: 100%;
	height: 100%;
	font-family: 'Noto Sans SC', 'Microsoft YaHei', 'Segoe UI', sans-serif;
	background: #fdf8f0;
	color: #333;
	overflow: hidden;
}

.container {
	display: flex;
	flex-direction: column;
	height: 100%;
	padding: 20px;
}

/* æ ‡é¢˜æ ï¼ˆå¯æ‹–åŠ¨ï¼‰ */
.title-bar {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 8px;
	-webkit-app-region: drag;
	cursor: move;
}

.title-bar h3 {
	font-size: 18px;
	font-weight: 600;
	color: #d4a017;
	margin: 0;
}

.close-btn {
	-webkit-app-region: no-drag;
	width: 28px;
	height: 28px;
	border: none;
	background: transparent;
	color: #999;
	font-size: 18px;
	cursor: pointer;
	border-radius: 4px;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: all 0.2s;
}
.close-btn:hover {
	background: rgba(255,80,80,0.15);
	color: #e74c3c;
}

/* æç¤ºæ–‡å­— */
.hint {
	color: #888;
	font-size: 12px;
	margin-bottom: 12px;
}

/* æˆªå›¾é¢„è§ˆåŒº */
.preview-area {
	flex: 1;
	min-height: 0;
	background: #f5f0e5;
	border: 1px solid #e8d5a0;
	border-radius: 8px;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
}

.preview-area img {
	max-width: 100%;
	max-height: 100%;
	object-fit: contain;
}

/* ä¿¡æ¯åŒº */
.info-area {
	background: #f5f0e5;
	border: 1px solid #e8d5a0;
	border-radius: 8px;
	padding: 8px 12px;
	margin-top: 10px;
	font-size: 12px;
	color: #666;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

/* æ¶ˆæ¯è¾“å…¥ */
.message-area {
	margin-top: 12px;
}

.message-area textarea {
	width: 100%;
	height: 80px;
	padding: 10px;
	border: 2px solid #d4a017;
	border-radius: 8px;
	font-size: 14px;
	font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
	background: #fff;
	color: #333;
	resize: none;
	outline: none;
	transition: border-color 0.2s, box-shadow 0.2s;
}

.message-area textarea:focus {
	border-color: #b8860b;
	box-shadow: 0 0 0 3px rgba(212, 160, 23, 0.15);
}

.message-area textarea::placeholder {
	color: #aaa;
}

/* æŒ‰é’®åŒº â€” ä¸‰æŒ‰é’® */
.btn-row {
	display: flex;
	gap: 10px;
	margin-top: 15px;
}

.btn {
	flex: 1;
	padding: 10px 16px;
	border: none;
	border-radius: 8px;
	font-size: 14px;
	font-weight: bold;
	font-family: inherit;
	cursor: pointer;
	transition: transform 0.2s ease, opacity 0.2s ease;
}
.btn:hover {
	transform: translateY(-1px);
}
.btn:active {
	transform: translateY(0);
}

.btn-cancel {
	background: #eee;
	color: #999;
}
.btn-cancel:hover {
	background: #e0e0e0;
	color: #666;
}

.btn-secondary {
	background: #e8d5a0;
	color: #8b7355;
}
.btn-secondary:hover {
	background: #dfc98e;
	color: #7a6344;
}

.btn-primary {
	background: #d4a017;
	color: #fff;
}
.btn-primary:hover {
	background: #c4920f;
	box-shadow: 0 2px 8px rgba(212, 160, 23, 0.3);
}

/* Toast é€šçŸ¥ */
.toast {
	position: fixed;
	bottom: 16px;
	left: 50%;
	transform: translateX(-50%);
	padding: 8px 18px;
	background: rgba(212, 160, 23, 0.9);
	color: #fff;
	border-radius: 8px;
	font-size: 13px;
	opacity: 0;
	transition: opacity 0.3s ease;
	pointer-events: none;
	text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
	box-shadow: 0 4px 12px rgba(212, 160, 23, 0.3);
	z-index: 100;
}
.toast.visible { opacity: 1; }
</style>
</head>
<body>
<div class="container">
	<!-- æ ‡é¢˜æ  -->
	<div class="title-bar">
		<h3>âœ¦ åˆ†äº«ç»™è´éœ²</h3>
		<button class="close-btn" id="btn-close">Ã—</button>
	</div>

	<!-- æç¤º -->
	<p class="hint" id="hint-text">å·²æˆªå›¾ã€‚è¾“å…¥æ–‡å­—å‘é€ç»™è´éœ²ï¼Œæˆ–ç›´æ¥åˆ†äº«æˆªå›¾ã€‚</p>

	<!-- æˆªå›¾é¢„è§ˆ -->
	<div class="preview-area">
		<img id="preview-img" alt="æˆªå›¾é¢„è§ˆ">
	</div>

	<!-- ä¿¡æ¯åŒº -->
	<div class="info-area" id="info-area">ğŸ“¸ æ¡Œé¢æˆªå›¾</div>

	<!-- è¾“å…¥æ¡† -->
	<div class="message-area">
		<textarea id="message-input" placeholder="æƒ³å¯¹è´éœ²è¯´ä»€ä¹ˆï¼Ÿ&#10;ï¼ˆç•™ç©ºåˆ™ä»…åˆ†äº«æˆªå›¾ï¼‰"></textarea>
	</div>

	<!-- ä¸‰ä¸ªæŒ‰é’® -->
	<div class="btn-row">
		<button class="btn btn-cancel" id="btn-cancel">å–æ¶ˆ</button>
		<button class="btn btn-secondary" id="btn-passive">ä»…åˆ†äº«</button>
		<button class="btn btn-primary" id="btn-send">å‘é€ âœ¦</button>
	</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
(() => {
	const previewImg = document.getElementById('preview-img')
	const messageInput = document.getElementById('message-input')
	const hintText = document.getElementById('hint-text')
	const infoArea = document.getElementById('info-area')
	const btnSend = document.getElementById('btn-send')
	const btnPassive = document.getElementById('btn-passive')
	const btnCancel = document.getElementById('btn-cancel')
	const btnClose = document.getElementById('btn-close')
	const toastEl = document.getElementById('toast')

	let imageDataUrl = null

	// Toast é€šçŸ¥
	function showToast(msg, duration = 2000) {
		toastEl.textContent = msg
		toastEl.classList.add('visible')
		clearTimeout(toastEl._timer)
		toastEl._timer = setTimeout(() => toastEl.classList.remove('visible'), duration)
	}

	// æ¥æ”¶ä¸»è¿›ç¨‹ä¼ æ¥çš„æˆªå›¾é¢„è§ˆ
	window.desktopEye.onSetPreview((dataUrl) => {
		imageDataUrl = dataUrl
		previewImg.src = dataUrl

		// æ˜¾ç¤ºæˆªå›¾æ—¶é—´
		const now = new Date()
		const timeStr = now.toLocaleString('zh-CN', {
			year: 'numeric', month: '2-digit', day: '2-digit',
			hour: '2-digit', minute: '2-digit'
		})
		infoArea.textContent = 'ğŸ“¸ æ¡Œé¢æˆªå›¾ Â· ' + timeStr
	})

	// å‘é€ï¼ˆä¸»åŠ¨æ¨¡å¼ â€” éœ€è¦è¾“å…¥æ¶ˆæ¯ï¼‰
	btnSend.addEventListener('click', () => {
		if (!imageDataUrl) return
		const userMessage = messageInput.value.trim()
		if (!userMessage) {
			// æ²¡æœ‰è¾“å…¥æ—¶æç¤º
			messageInput.style.borderColor = '#e74c3c'
			messageInput.placeholder = 'è¯·è¾“å…¥è¦å¯¹è´éœ²è¯´çš„è¯ï¼Œ\næˆ–è€…ç‚¹å‡»"ä»…åˆ†äº«"'
			setTimeout(() => { messageInput.style.borderColor = '#d4a017' }, 2000)
			return
		}
		showToast('âœ¦ å·²å‘é€ç»™è´éœ²ï¼Œç­‰å¥¹å›å¤...')
		setTimeout(() => {
			window.desktopEye.sendScreenshot({
				imageBase64: imageDataUrl,
				message: userMessage,
				mode: 'active',
			})
		}, 500)
	})

	// ä»…åˆ†äº«ï¼ˆè¢«åŠ¨æ¨¡å¼ â€” ä¸éœ€è¦è¾“å…¥æ¶ˆæ¯ï¼‰
	btnPassive.addEventListener('click', () => {
		if (!imageDataUrl) return
		showToast('âœ¦ æˆªå›¾å·²åˆ†äº«ç»™è´éœ²')
		setTimeout(() => {
			window.desktopEye.sendScreenshot({
				imageBase64: imageDataUrl,
				message: '',
				mode: 'passive',
			})
		}, 500)
	})

	// å–æ¶ˆ
	btnCancel.addEventListener('click', () => {
		window.desktopEye.sendCancel()
	})

	btnClose.addEventListener('click', () => {
		window.desktopEye.sendCancel()
	})

	// å¿«æ·é”®
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape') {
			window.desktopEye.sendCancel()
		}
		// Enter å‘é€ï¼ˆShift+Enter æ¢è¡Œï¼‰
		if (e.key === 'Enter' && !e.shiftKey && document.activeElement === messageInput) {
			e.preventDefault()
			btnSend.click()
		}
		// Ctrl+Enter ä¹Ÿå¯ä»¥å‘é€
		if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
			e.preventDefault()
			btnSend.click()
		}
	})

	// è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
	setTimeout(() => messageInput.focus(), 100)
})()
</script>
</body>
</html>